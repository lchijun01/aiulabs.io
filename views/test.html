<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume AI - Aiulabs.io</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="/views/images/favicon.png" rel="shortcut icon" type="image/x-icon">
    <link href="/views/images/webclip.png" rel="apple-touch-icon">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.0/jspdf.umd.min.js"></script>
    <script src="https://kit.fontawesome.com/332cfc7815.js" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function() {
            const urlParams = new URLSearchParams(window.location.search);
            const templateId = urlParams.get('templateId');
        
            if (templateId) {
                loadTemplateContent(templateId); // Load specific template content using its ID
            }
        });
    </script>
    <style>
        @font-face { 
            font-family: 'Calibri'; 
            src: url('/views/fonts/Calibri.woff2') format('woff2'), 
                url('/views/fonts/Calibri.woff') format('woff'); 
            font-weight: normal; 
            font-style: normal; 
        } 
        * {
            margin: 0;
        }
        body {
            font-family: helvetica, sans-serif;
            background-color: #333144;
            margin: 0;
            padding: 0;
        }
        [contenteditable] {
            line-height: 1.5; /* Apply line height only to editable content */
        }
        ul {
            padding-left: 20px;
            position: relative;
        }
        .container {
            width: 210mm; /* A4 width */
            height: 297mm; /* A4 height */
            margin: 0 auto; /* Center the container */
            background: #fff;
            padding: 10mm; /* Add padding in mm for consistency */
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow: visible; /* Ensure content doesn't overflow */
            box-sizing: border-box; /* Include padding in total size */
            position: relative;
        }
        .section {
            margin-bottom: 15px;
        }
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #2d2d2d;
        }
        .section-title {
            font-size: 14px;
            font-weight: bold;
            color: #2A4879; /* Standard dark blue */
            margin: 0;
            cursor: default;
            line-height: 1.5;
        }
        .drag-handle {
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
        }
        .drag-handle::before {
            content: "⋮⋮";
            font-size: 16px;
            color: #666;
        }
        .content {
            font-size: 11px;
        }
        .placeholder {
            color: #cecece !important; /* Placeholder text color */
        }
        .editable-text {
            width: 85%;
            border-bottom: 1px solid transparent !important; /* Default state */
            transition: background-color 0.3s, border-bottom-color 0.3s;
            outline: none;
            color: #000; /* Default text color */
            outline: none;
            border: none;
        }
        .editable-text:focus {
            background-color: #fef0ff;
            border-bottom-color: #580067 !important;
            outline: none;
        }
        /* Top-Info & Image */
        .top-info {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: left;
            margin-bottom: 15px;
        }
        .image-box {
            width: 90px;
            height: 116px;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            overflow: hidden;
            cursor: pointer;
            text-align: center;
        }
        .image-box img {
            max-width: 100%;
            max-height: 100%;
        }
        .info-text {
            font-size: 12px;
        }
        .info-text table {
            width: 100%;
            border-collapse: collapse;
        }
        .info-text .label {
            text-align: left;
            font-weight: bold;
            font-size: 12px;
            white-space: nowrap;
            padding-right: 5px;
        }
        .info-text .separator {
            text-align: center;
            font-weight: bold;
            font-size: 12px;
            width: 10px;
        }
        .info-text .value {
            text-align: left;
            font-size: 12px;
            word-wrap: break-word;
            width: 100%;
        }
        .content {
            margin: 1mm 0 2mm 0;
        }
        /* Style the ghost element during dragging */
        .dragging-ghost {
            height: 30px;
            overflow: hidden;
            background: #f5f5f5;
            border: 1px solid #ddd;
            box-shadow: none;
        }
        .dragging-ghost .content {
            display: none;
        }
        .skills-content {
            display: table;
            width: 100%;
        }
        .skill-row {
            width: 100%;
            display: flex;
            padding-right: 20%;
            margin-bottom: 1px;
            line-height: 1.5;
        }
        .skill-category {
            display: table-cell;
            font-size: 11px;
            font-weight: bold;
            text-align: left;
            white-space: normal; /* Allow wrapping */
            word-wrap: break-word; /* Break long words */
            padding-right: 10px;
            width: 20mm;
        }
        .skill-detail {
            width: calc((190mm * 0.85) - 20mm - 15px);
            display: table-cell;
            font-size: 11px;
            white-space: normal; /* Allow wrapping */
            word-wrap: break-word; /* Break long words */
            text-align: left;
            padding-left: 5px;

        }
        .skill-row:hover .remove-button {
            display: inline-block;
        }
        .research-row {
            width: 100%;
            display: flex;
            padding-right: 20%;
        }
        .research-row:hover .remove-button {
            display: inline-block;
        }
        .leadership-row {
            width: 100%;
            display: flex;
            padding-right: 20%;
        }
        .leadership-row:hover .remove-button {
            display: inline-block;
        }
        .award-row {
            width: 100%;
            display: flex;
            padding-right: 20%;
        }
        .award-row:hover .remove-button {
            display: inline-block;
        }
        .value a {
            color: #007bff; /* Link color */
            text-decoration: none; /* Remove underline */
        }
        .value a:hover {
            text-decoration: underline; /* Add underline on hover */
        }
        .pagination-line {
            width: 100%;
            border-top: 1px dashed #ddd;
            text-align: center;
            font-size: 12px;
            color: #666;
            position: absolute;
            left: 0;
            text-align: left;
        }
        .pagination-line span {
            position: relative;
            top: -15px;
            background: white;
            padding: 0 5px;
        }
        /* Date picker */
        .date-container {
            display: flex;
            align-items: center;
            gap: 3px;
            font-weight: bold;
        }
        .date-display {
            cursor: pointer;
            color: black; /* Black text color */
            text-decoration: none; /* Remove underline */
            position: relative;
        }
        .month-picker {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 200px;
            text-align: center;
            cursor: default;
            border-radius: 8px; /* Slightly rounded corners for a modern look */
            z-index: 2;
        }
        .month-picker .year {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .month-picker .months {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
        }
        .month-picker .month {
            width: 45px;
            padding: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.1s ease-in-out; /* Smooth transition */
            border-radius: 6px;
            background-color: white; /* Default background */
        }
        .month-picker .month:hover {
            background-color: #eaeefc; /* Soft pastel hover color */
            color: #4a6ef5; /* Contrast text color */
            transform: scale(1.1); /* Slight zoom effect */
        }
        .month-picker .actions {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
        }
        .month-picker .action {
            cursor: pointer;
            font-size: 14px;
            color: #4a6ef5; /* Soft blue for actions */
            transition: color 0.1s ease-in-out; /* Smooth color transition */
        }
        .month-picker .action:hover {
            color: #354bb7; /* Darker blue on hover */
        }
        .year span {
            cursor: pointer;
            transition: all 0.1s ease-in-out; /* Smooth transition for year navigation */
        }
        .year span:hover {
            color: #4a6ef5; /* Match hover color for consistency */
            transform: scale(1.2); /* Slight zoom effect */
        }
        .year-picker {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 200px;
            text-align: center;
            cursor: default;
            border-radius: 8px; /* Rounded corners */
            z-index: 2;
        }
        .year-picker .year-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .year-picker .year-navigation span {
            cursor: pointer;
            transition: color 0.2s ease-in-out;
            color: black; /* Blue for navigation arrows */
            cursor: pointer;
            transition: all 0.1s ease-in-out;
        }
        .year-picker .year-navigation span:hover {
            color: #354bb7; /* Darker blue on hover */
            color: #4a6ef5; /* Match hover color for consistency */
            transform: scale(1.2); /* Slight zoom effect */
        }
        .year-picker .years {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
            font-size: 14px;
        }
        .year-picker .year {
            width: 45px;
            padding: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.1s ease-in-out;
            border-radius: 6px;
            background-color: white; /* Default background */
        }
        .year-picker .year:hover {
            background-color: #eaeefc; /* Soft pastel hover color */
            color: #4a6ef5; /* Contrast text color */
            transform: scale(1.1); /* Slight zoom effect */
        }
        .year-picker .actions {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
        }
        .year-picker .action {
            cursor: pointer;
            font-size: 14px;
            color: #4a6ef5; /* Soft blue for actions */
            transition: color 0.1s ease-in-out;
        }
        .year-picker .action:hover {
            color: #354bb7; /* Darker blue on hover */
        }
        /* Add more button */
        .add-button {
            border: none;
            cursor: pointer;
            text-align: center;
            display: none;
            position: relative;
            color: grey;
            background: 0;
            align-items: center;
            margin-left: 2mm;
        }
        .add-button:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%; /* Position above the button */
            left: 50%;
            transform: translateX(-50%);
            background-color: #1a1a1a;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
            white-space: nowrap;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            font-size: 12px;
            opacity: 1;
            z-index: 10;
        }
        .remove-button {
            border: none;
            cursor: pointer;
            text-align: center;
            display: none;
            position: relative;
            color: rgb(255, 0, 0);
            background: 0;
            align-items: center;
            margin-left: 2mm;
        }
        .remove-button:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1a1a1a;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
            white-space: nowrap;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            font-size: 12px;
            opacity: 1;
            z-index: 10;
        }
        .section-title .remove-button, .section-title .add-button {
            display: none; /* Hide the remove button by default */
        }
        .section-title:hover .remove-button, .section-title:hover .add-button {
            display: inline-block; /* Display the remove button when hovering over .section-title p */
        }
        .add-project-button {
            border: none;
            cursor: pointer;
            text-align: center;
            display: inline-block;
            position: relative;
            color: grey;
            background: 0;
            align-items: center;
            margin-left: 2mm;
        }
        .add-project-button:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%; /* Position above the button */
            left: 50%;
            transform: translateX(-50%);
            background-color: #1a1a1a;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
            white-space: nowrap;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            font-size: 12px;
            opacity: 1;
            z-index: 10;
        }

        .add-button1 {
            border: none;
            cursor: pointer;
            text-align: center;
            position: absolute;
            color: grey;
            background: 0;
            align-items: center;
            margin-left: 2mm;
            left: 0;
        }
        .add-button1:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%; /* Position above the button */
            left: 50%;
            transform: translateX(-50%);
            background-color: #1a1a1a;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
            white-space: nowrap;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            font-size: 12px;
            opacity: 1;
            z-index: 10;
        }
        .remove-button1 {
            border: none;
            cursor: pointer;
            text-align: center;
            position: absolute;
            color: rgb(255, 0, 0);
            background: 0;
            align-items: center;
            margin-left: 2mm;
            right: 5px;
        }
        .remove-button1:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1a1a1a;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
            white-space: nowrap;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            font-size: 12px;
            opacity: 1;
            z-index: 10;
        }
        /* Ruler */
        .sets {
            display: flex;
            margin-left: 5px;
            padding-left: 5px;
        }
        .sets button {
            background-color: transparent;
            border: 0;
            cursor: pointer;
            padding: 2mm 3mm;
            color: white;
        }
        .sets button:hover {
            background-color: #272636;
        }
        .sets select {
            padding: 2mm 3mm;
            background-color: transparent;
            border: 0;
            border-radius: 8px;
            cursor: pointer;
            color: white;
        }
        .sets select:hover {
            background-color: #272636;
        }
        .sets select:hover  option{
            background-color: #272636;
        }
        .button-container {
            width: 100px;
        }
        .button-container button {
            border: 0;
            border-radius: 5px;
            background-color: rgb(226, 210, 242);
            width: 100px;
            height: 40px;
            font-weight: bold;
            cursor: pointer;
        }
        .button-container p {
            width: auto;
            max-width: 200px;
            position: absolute;
            border: 0;
            top: 10px;
            left: 10%;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            font-size: 20px;
            border-bottom: 1px solid black !important;
            color: black !important;
            padding: 2mm;
        }
        .draggable-section {
            padding: 1mm 0;
            margin-bottom: 5mm;
            cursor: move;
        }
        #ruler {
            position: relative;
            width: 21cm;
            height: 20px;
            background: #272636;
            margin: 0 auto;
            display: flex;
            align-items: center;
            user-select: none;
        }
        .tick {
            position: absolute;
            height: 100%;
            color: #9a9a9a;
            font-size: 10px;
            line-height: 20px;
        }
        .draggable-marker {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 12px solid #ff0000; /* Triangle color */
            cursor: ew-resize;
            transform: translateX(-50%); /* Center align the triangle */
            z-index: 30; /* Higher z-index to ensure it's above other elements */
        }
        #left-marker {
            left: 10mm; /* Default padding for left */
        }
        #right-marker {
            left: calc(210mm - 10mm); /* Default position for right marker */
        }
        .measure-line {
            position: absolute;
            width: 0.2px;
            min-height: 100vh;
            background-color: #ff0000;
            display: none;
            top: 0;
            left: 10mm;
            z-index: 20;
        }
        .back-button {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            background-color: #2C2C2C;
            color: white;
            cursor: pointer;
            position: fixed;
            top: 10px;
            left: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s;
        }
        .back-button i {
            font-size: 20px;
        }
        .back-button:hover {
            background-color: #3B1F4C;
        }
        .button-container {
            margin-top: 20px; /* Adjust as needed */
        }
        /* GPT button & form */
        .work-experience-entry {
            margin-top: 20px;
        }
        ul:hover li {
            background-color: #fef0ff;
        }
        .gpt-generate-form {
            width: 500px;
            height: auto;
            border-radius: 10px;
            background-color: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            font-family: Calibri, sans-serif;
            display: flex;
            position: fixed; /* Fixed ensures positioning relative to the viewport */
            top: 50%; /* Center vertically in the viewport */
            left: 50%; /* Center horizontally in the viewport */
            transform: translate(-50%, -50%); /* Adjust for element's own size */
            cursor: grab; /* Dragging cursor */
            z-index: 1000; /* Ensure it's above other elements */
        }
        .gpt-generate-form.dragging {
            cursor: grabbing;
            transform: none;
        }
        .gpt-generate-btn {
            position: absolute;
            top: 50%; /* Center vertically relative to UL */
            left: 50%; /* Center horizontally relative to UL */
            transform: translate(-50%, -50%); /* Adjusts position to align with the center */
            z-index: 10; /* Ensures button is on top */
            display: none;
            align-items: center;
            padding: 5px 10px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            color: #ffffff;
            cursor: pointer;
            background: linear-gradient(45deg, #ff0077, #9b00e5);
            transition: transform 0.2s ease-in-out;
            outline: none;
        }
        ul:hover .gpt-generate-btn {
            display: inline-block;
        }
        .generate-btn-container {
            display: flex;
            justify-content: flex-end; /* Align button to the right */
            margin-top: 10px; /* Optional: space above the button */
        }
        .generate-btn {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            border: none;
            border-radius: 8px; /* Rounded corners */
            font-size: 16px;
            font-weight: bold;
            color: #ffffff;
            cursor: pointer;
            background: linear-gradient(45deg, #ff0077, #9b00e5); /* Gradient background */
            transition: transform 0.2s ease-in-out;
            outline: none;
        }
        .generate-btn i {
            margin-right: 8px; /* Space between icon and text */
            font-size: 18px;
        }
        .generate-btn:hover {
            transform: scale(1.05); /* Slight zoom effect on hover */
        }
        .generate-btn:active {
            transform: scale(0.98); /* Slight press effect on click */
        }
        .form-group {
            margin-bottom: 20px;
            padding: 0 20px;
        }
        .form-group label {
            display: block;
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 8px;
            color: #333;
        }
        .form-field {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-field:focus {
            border-color: #DD00AC;
            outline: none;
        }
        /* Close button style */
        .form-header {
            display: flex;
            align-items: center;
            justify-content: space-between; /* Aligns the close button to the top-right */
            margin-bottom: 20px; /* Adds some space below the header */
            cursor: default;
            padding: 20px;
        }
        .close-btn {
            background-color: transparent;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #888;
            transition: color 0.3s;
            position: absolute;
            top: 20px;
            right: 20px; /* Adjusts to the right within the form */
        }
        .close-btn:hover {
            color: #333;
        }
        textarea.form-field {
            resize: none;
        }
        .gpt-suggestions {
            border-top: 1px solid #ddd;
            background-color: #DEDEDE;
            padding: 20px;
            border-radius: 0 0 10px 10px;
        }
        .bullet-point-option {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            cursor: pointer; /* Makes the row clickable */
            transition: background-color 0.2s;
            background-color: #f9f9f9;
        }
        .bullet-point-option:hover {
            background-color: #f0f0f0; /* Highlight effect on hover */
        }
        .bullet-checkbox {
            margin-right: 10px; /* Space between checkbox and text */
            cursor: pointer;
            transform: scale(1.2); /* Slightly larger checkbox */
        }
        .bullet-point-option span {
            color: #333;
            font-size: 14px;
        }
        .bullet-point-option input[type="checkbox"]:checked + span {
            font-weight: bold; /* Optional: Make checked items bold */
            color: #333;
        }
        /* Save as pdf */
        .pdf-export .placeholder, 
        .pdf-export .gpt-generate-btn, 
        .pdf-export .remove-button, 
        .pdf-export .drag-handle, 
        .pdf-export button {
            display: none !important; /* Hide placeholders and buttons */
        }
        .pdf-export ul {
            list-style-type: disc !important; 
        } 
        .custom-download-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px; /* Spacing between icon and text */
            background-color: #1E1E29; /* Background color similar to your layout */
            color: #FFFFFF; /* Text color */
            font-size: 16px;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .custom-download-btn i {
            font-size: 18px; /* Adjust icon size */
            color: #EADDFF; /* Icon color similar to the one in your image */
        }
        .custom-download-btn:hover {
            background-color: #3B1F4C; /* Background color on hover */
            color: #FFFFFF; /* Text color on hover */
        }
        /* add section button */
        /* Modal Styling */
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            text-align: center;
            width: 300px;
        }
        .modal-header {
            font-size: 20px;
            color: #4A47A3;
            margin-bottom: 15px;
        }
        /* Buttons inside the modal */
        .modal-button {
            background-color: #6A61C1;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            font-size: 14px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .modal-button:hover {
            background-color: #4A47A3;
            transform: scale(1.05);
        }
        .modal-close-button {
            background-color: #E5E5E5;
            color: #333;
            border: none;
            padding: 10px 15px;
            font-size: 14px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        .modal-close-button:hover {
            background-color: #C5C5C5;
        }
        /* Add Section Button Styling */
        .add-section-container {
            text-align: center;
            margin: 20px 0;
        }
        .add-section-button {
            background-color: #6A61C1;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .add-section-button:hover {
            background-color: #4A47A3;
            transform: scale(1.1);
        }
        .modal-button-container {
            width: 100%;
            display: flex;
            flex-direction: column;
        }
    </style>
    <!-- customize -->
    <style>
        .bold {
            font-weight: bold;
        }
        .italic {
            font-style: italic;
        }
        #font-size-dropdown {
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 4px;
            background-color: #333144;
            color: white;
            font-size: 14px;
        }
        #font-size-dropdown option {
            background-color: #333144;
            color: white;
        }

    </style>
</head>
<body>
<section style="width: 100%; position: block; top: 0; height: auto; background-color: #1E1E29; position: fixed; z-index: 30;">
    <div style="display: flex; align-items: center; justify-content: space-between; margin: 0 5%;">
        <button class="back-button" onclick="goBackToDashboard()"><i class="bi bi-arrow-left"></i></button>
        <div class="button-container">
            <div id="save-status"></div>
            <p id="template-name" style="border: #AFAFAF 2px; border-radius: 4px; color: white !important; background-color: #333144; width: 500px !important; margin-top: 3px;" contenteditable="true" spellcheck="false" class="editable-text placeholder">Untitled</p>
        </div>
        <div style="display: flex; padding: 1%; justify-content: center; justify-self: center;">
            <div class="sets">
                <button style="border-radius: 8px 0 0 8px;" data-tooltip="Bold" onclick="document.execCommand('bold', false, '')"><strong>B</strong></button>
                <button data-tooltip="Italic" onclick="document.execCommand('italic', false, '')"><i class="fa-solid fa-italic"></i></button>
                <button style="border-radius: 0 8px 8px 0;" data-tooltip="Underline" onclick="document.execCommand('underline', false, '')"><i class="fa-solid fa-underline"></i></button>
            </div>

            <div class="sets">
                <button style="border-radius: 8px 0 0 8px;" data-tooltip="Justify Left" onclick="document.execCommand('justifyLeft', false, '')"><i class='fas fa-align-left'></i></i></button>
                <button data-tooltip="Justify Center" onclick="document.execCommand('justifyCenter', false, '')"><i class='fas fa-align-center'></i></button>
                <button style="border-radius: 0 8px 8px 0;" data-tooltip="Justify Right" onclick="document.execCommand('justifyRight', false, '')"><i class='fas fa-align-right'></i></button>
            </div>

            <div class="sets">
                <label for="font-size-dropdown" style="color: white; margin-right: 10px;">Font Size:</label>
                <select id="font-size-dropdown" onchange="setFontSize()">
                    <option value="reset">Reset</option>
                    <option value="12">12px</option>
                    <option value="14">14px</option>
                    <option value="16" selected>16px</option>
                    <option value="18">18px</option>
                    <option value="20">20px</option>
                    <option value="24">24px</option>
                    <option value="28">28px</option>
                    <option value="32">32px</option>
                </select>
            </div>

            <div class="sets">
                <button style="border-radius: 8px 0 0 8px;" onclick="changeLineHeight(-0.1)"><i class='fas fa-minus'></i></button>
                <button onclick="resetLineHeight()"><i class="material-icons" style="font-size:18px">format_line_spacing</i></button>
                <button style="border-radius: 0 8px 8px 0;" onclick="changeLineHeight(0.1)"><i class='fas fa-plus'></i></button>
            </div>
        </div>
        <div>
            <button id="download-pdf" class="custom-download-btn">
                <i class="fa fa-download"></i>Download
            </button>
        </div>
    </div>
    <div style="width: 100%; background-color: #272636; justify-content: center; display: flex;">
        <div id="ruler" style="width: 210mm; margin-right: 2mm; margin-left: 0;">
            <div class="measure-line" id="left-measure-line"></div>
            <div class="measure-line" id="right-measure-line"></div>
            <div class="draggable-marker" id="left-marker"></div>
            <div class="draggable-marker" id="right-marker"></div>
        </div>
    </div>
</section>
<div style="margin: 100px 0;">
    <div class="container" id="resume-container">
        <div id="draggable-container">
            <!-- Top Info Section (not draggable) -->
            <div class="section top-info">
                <div class="image-box" id="image-box">
                    <p class="image-upload">Upload Image</p>
                </div>
                <div class="info-text">
                    <p id="editable-text" class="editable-text placeholder name" data-placeholder="[FULL NAME]" contenteditable="true" style="font-size: 18px; font-weight: bold; color: #2A4879; text-transform: uppercase; width: auto; max-width: 518px;">[FULL NAME]</p>
                    <table>
                        <tr>
                            <td class="label">Address</td>
                            <td class="separator">:</td>
                            <td class="editable-text placeholder value" data-placeholder="[City], [State]" contenteditable="true">[City], [State]</td>
                        </tr>
                        <tr>
                            <td class="label">Mobile</td>
                            <td class="separator">:</td>
                            <td class="editable-text placeholder value" data-placeholder="[Phone Number]" contenteditable="true">[Phone Number]</td>
                        </tr>
                        <tr>
                            <td class="label">Email</td>
                            <td class="separator">:</td>
                            <td class="editable-text placeholder value" data-placeholder="[Email Address]" contenteditable="true">[Email Address]</tr>
                        </tr>
                        <tr>
                            <td class="label">LinkedIn</td>
                            <td class="separator">:</td>
                            <td class="editable-text placeholder value" data-placeholder="[LinkedIn Profile URL]" contenteditable="true">[LinkedIn Profile URL]</tr>
                        </tr>
                    </table>
                </div>
            </div>        
    
            <!-- Objective Section -->
            <div id="objective" class="section">
                <div class="section-header">
                    <div class="section-title" style="display: flex;">
                        <p>OBJECTIVE</p>
                        <button class="remove-button" data-tooltip="Remove section" onclick="removeObjectiveSection(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                    <div class="drag-handle"></div>
                </div>
                <div class="content">
                    <p id="editable-text" class="editable-text placeholder" data-placeholder="[A one-sentence pitch that summarizes your experience, skills, or achievements that make you stand out from others]. Aspire to seek available [position title] position within your organisation/at [company name]." contenteditable="true">
                        [A one-sentence pitch that summarizes your experience, skills, or achievements that make you stand out from others]. Aspire to seek available [position title] position within your organisation/at [company name].
                    </p>
                </div>
            </div>
    
            <!-- Work Experience Section -->
            <div id="work-experience" class="section">
                <div class="section-header">
                    <div class="section-title" style="display: flex;">
                        <p>WORK&nbsp;EXPERIENCE</p>
                        <button class="add-button" data-tooltip="Add work-experience" onclick="addWorkExperience()"><i class="bi bi-plus-circle"></i></button>
                        <button class="remove-button" data-tooltip="Remove section" onclick="removeWorkExperienceSection(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                    <div class="drag-handle"></div>
                </div>
                <div id="work1" class="content">
                    <div style="display: flex; max-width: 100%; justify-content: space-between;">
                        <p style="width: 60%;" id="editable-text" class="editable-text placeholder bold" contenteditable="true" data-placeholder="[Company Name]">[Company Name]</p>
                        <button class="add-button1" onclick="addProject(1)" data-tooltip="Add more project"><i class="bi bi-plus-circle"></i></button>
                        <div class="date-container">
                            <strong>(</strong>
                            <div>
                                <span id="start-date-display-11" class="date-display" onclick="openMonthPicker('start', 11)">Start Date</span>
                                <div id="start-month-picker-11" class="month-picker" style="display: none;"></div>
                            </div>
                            <strong>-</strong>
                            <div>
                                <span id="end-date-display-11" class="date-display" onclick="openMonthPicker('end', 11)">Present</span>
                                <div id="end-month-picker-11" class="month-picker" style="display: none;"></div>
                            </div>
                            <strong>)</strong>
                        </div>
                    </div>
                    
                    <p id="editable-text" class="editable-text placeholder italic" data-placeholder="[Job Title]" contenteditable="true">[Job Title]</p>
                    <ul>
                        <li id="bullet-points-1-1" class="editable-text placeholder" data-placeholder="Bullet point 1" contenteditable="true">Bullet point 1</li>
                        <li id="bullet-points-1-2" class="editable-text placeholder" data-placeholder="Bullet point 2" contenteditable="true">Bullet point 2</li>
                        <li id="bullet-points-1-3" class="editable-text placeholder" data-placeholder="Bullet point 3" contenteditable="true">Bullet point 3</li>
                        <button type="button" class="gpt-generate-btn" onclick="showGptGenerateForm(1)">AI Generate✨</button>
                    </ul>
                    <div class="projects-container">
                        <!-- Project Section -->
                        <div id="project1-1" class="project" style="margin-top: 10px; padding-left: 20px;">
                            <div style="display: flex; flex-direction: column;">
                                <p style="font-weight: bold; margin-bottom: 1mm;">Project :</p>
                                <p id="editable-text" class="editable-text placeholder bold" data-placeholder="[Project Name]" contenteditable="true">[Project Name]</p>
                            </div>
                            <ul>
                                <li id="bullet-points-A1-1-1" class="editable-text placeholder" data-placeholder="Project bullet point 1" contenteditable="true">Project bullet point 1</li>
                                <li id="bullet-points-A1-1-2" class="editable-text placeholder" data-placeholder="Project bullet point 2" contenteditable="true">Project bullet point 2</li>
                                <li id="bullet-points-A1-1-3" class="editable-text placeholder" data-placeholder="Project bullet point 3" contenteditable="true">Project bullet point 3</li>
                                <button type="button" class="gpt-generate-btn" onclick="showGptGenerateFormA(1, 1)">AI Generate✨</button>
                            </ul>
                            <!-- project gpt form -->
                            <div class="gpt-generate-form" id="gpt-generate-form-A1-1" style="display:none;">
                                <div class="form-header" style="display: flex; align-items: center; justify-content: space-between;">
                                    <div class="drag-handle" title="Drag to move"></div>
                                    <button class="close-btn" onclick="closeGptFormA(1, 1)">✕</button>
                                </div>
                                <div style="margin: 20px;">
                                    <h1 style="font-size:30px; margin: 0;">Create work experience</h1>
                                    <div class="form-group">
                                        <label for="role">What was your role?</label>
                                        <input type="text" class="role form-field" placeholder="e.g., Software Engineer">
                                    </div>
                                    <div class="form-group">
                                        <label for="experience-summary">Your work experience in one sentence:</label>
                                        <textarea class="experience-summary form-field" rows="2" placeholder="e.g., Led the development of a project to reduce manual tasks..."></textarea>
                                    </div>
                                    <div class="generate-btn-container">
                                        <button type="button" class="generate-btn" onclick="generateExperienceA(1, 1)">
                                            <i class="fa-solid fa-bolt"></i> Generate
                                        </button>
                                    </div>
                                </div>
                                <div class="gpt-suggestions">
                                    <div class="suggestion-options">
                                        <p id="placeholder-messageA" style="color: #888;">Please enter your role and work experience above</p>
                                        <!-- Generated suggestions with checkboxes will appear here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- work gpt form -->
                    <div class="gpt-generate-form" id="gpt-generate-form-1" style="display:none;">
                        <div class="form-header" style="display: flex; align-items: center; justify-content: space-between;">
                            <div class="drag-handle" title="Drag to move"></div>
                            <button class="close-btn" onclick="closeGptForm(1)">✕</button>
                        </div>
                        <div style="margin: 20px;">
                            <h1 style="font-size:30px; margin: 0;">Create work experience</h1>
                            <div class="form-group">
                                <label for="role">What was your role?</label>
                                <input type="text" class="role form-field" placeholder="e.g., Software Engineer">
                            </div>
                            <div class="form-group">
                                <label for="experience-summary">Your work experience in one sentence:</label>
                                <textarea class="experience-summary form-field" rows="2" placeholder="e.g., Led the development of a project to reduce manual tasks..."></textarea>
                            </div>
                            <div class="generate-btn-container">
                                <button type="button" class="generate-btn" onclick="generateExperience(1)">
                                    <i class="fa-solid fa-bolt"></i> Generate
                                </button>
                            </div>
                        </div>
                        <div class="gpt-suggestions">
                            <div class="suggestion-options">
                                <p id="placeholder-message" style="color: #888;">Please enter your role and work experience above</p>
                                <!-- Generated suggestions with checkboxes will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Education Section -->
            <div id="education" class="section">
                <div class="section-header">
                    <div class="section-title" style="display: flex;">
                        <p>EDUCATIONAL BACKGROUND</p>
                        <button class="add-button" data-tooltip="Add university" onclick="addUniversity()"><i class="bi bi-plus-circle"></i></button>
                        <button class="remove-button" data-tooltip="Remove section" onclick="removeUniversitySection(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                    <div class="drag-handle"></div>
                </div>
                <div id="university1" class="content">
                    <div style="display: flex; max-width: 100%; justify-content: space-between;">
                        <p style="width: 60%;" id="editable-text" class="editable-text placeholder bold" data-placeholder="[Institution Name]" contenteditable="true">[Institution Name]</p>
                        <button class="add-button" data-tooltip="Add Degree" onclick="addDegree()"><i class="bi bi-plus-circle"></i></button>
                        <div class="date-container">
                            <strong>(</strong>
                            <div>
                                <span id="start-date-display-21" class="date-display" onclick="openMonthPicker('start', 21)">Start Date</span>
                                <div id="start-month-picker-21" class="month-picker" style="display: none;"></div>
                            </div>
                            <strong>-</strong>
                            <div>
                                <span id="end-date-display-21" class="date-display" onclick="openMonthPicker('end', 21)">Present</span>
                                <div id="end-month-picker-21" class="month-picker" style="display: none;"></div>
                            </div>
                            <strong>)</strong>
                        </div>
                    </div>
                    <p id="editable-text" class="editable-text placeholder" data-placeholder="[Degree Name]" contenteditable="true">[Degree Name]</p>
                    <button class="add-button" data-tooltip="Add Degree" onclick="addMajorCGPA()"><i class="bi bi-plus-circle"></i></button>
                </div>
            </div>
    
            <!-- Skills Section -->
            <div id="skills" class="section">
                <div class="section-header">
                    <div class="section-title" style="display: flex;">
                        <p>SKILLS</p>
                        <button class="add-button" data-tooltip="Add skill" onclick="addSkillRow()"><i class="bi bi-plus-circle"></i></button>
                        <button class="remove-button" data-tooltip="Remove section" onclick="removeSkillSection(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                    <div class="drag-handle"></div>
                </div>
                <div class="skills-content content">
                    <div class="skill-row">
                        <p id="editable-text" class="editable-text placeholder skill-category" contenteditable="true" class="bold" data-placeholder="[Category 1]">[Category 1]</p>
                        <strong>:</strong>
                        <p id="editable-text" class="editable-text placeholder skill-detail" contenteditable="true" class="bold" data-placeholder="[Skill 1], [Skill 2], [Skill 3]">[Skill 1], [Skill 2], [Skill 3]</p>
                        <button class="remove-button" data-tooltip="Remove" onclick="removeSkillRow(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                    <div class="skill-row">
                        <p id="editable-text" class="editable-text placeholder skill-category" contenteditable="true" class="bold" data-placeholder="[Category 2]">[Category 2]</p>
                        <strong>:</strong>
                        <p id="editable-text" class="editable-text placeholder skill-detail" contenteditable="true" class="bold" data-placeholder="[Skill 1], [Skill 2], [Skill 3]">[Skill 1], [Skill 2], [Skill 3]</p>
                        <button class="remove-button" data-tooltip="Remove" onclick="removeSkillRow(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                    <div class="skill-row">
                        <p id="editable-text" class="editable-text placeholder skill-category" contenteditable="true" class="bold" data-placeholder="[Category 3]">[Category 3]</p>
                        <strong>:</strong>
                        <p id="editable-text" class="editable-text placeholder skill-detail" contenteditable="true" class="bold" data-placeholder="[Skill 1], [Skill 2], [Skill 3]">[Skill 1], [Skill 2], [Skill 3]</p>
                        <button class="remove-button" data-tooltip="Remove" onclick="removeSkillRow(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                </div>
            </div>
        </div>
    
        <div id="pagination-container"></div>
        <!-- Add Section Modal -->
        <div id="add-section-modal" class="modal">
            <h2 class="modal-header">Add Section</h2>
            <div class="modal-button-container">
                <button class="modal-button" onclick="addSection('awards')">Awards & Recognition</button>
                <button class="modal-button" onclick="addSection('research')">Research Projects</button>
                <button class="modal-button" onclick="addSection('leadership')">Leadership Experience</button>
                <button class="modal-close-button" onclick="closeModal()">Close</button>
            </div>
        </div>

        <!-- Add Section Button -->
        <div class="add-section-container">
            <button class="add-section-button" onclick="openModal()">+ Add Section</button>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
<!-- back button ( dashboard ) -->
<script>
    function goBackToDashboard() {
        window.location.href = '/dashboard';
    }

    $(document).ready(function () {
        const urlParams = new URLSearchParams(window.location.search);
        const documentId = urlParams.get('id');

        if (documentId) {
            // Fetch the template name from the backend
            fetch(`http://localhost:3000/load/${documentId}`)
                .then(response => response.json())
                .then(data => {
                    // If there's a template name, display it
                    if (data.template_name) {
                        const fullName = data.template_name;
                        const truncatedName =
                            fullName.length > 10 ? fullName.slice(0, 10) + '...' : fullName;

                        // Set the truncated name with a tooltip showing the full name
                        $('#template-name')
                            .text(truncatedName)
                            .attr('title', fullName); // Add a tooltip with the full name
                    } else {
                        $('#template-name').text('Untitled').attr('title', 'Untitled'); // Fallback if no name found
                    }
                })
                .catch(error => console.error('Error fetching template:', error));
        }

        // Save the new template name to the server on input
        $('#template-name').on('input', function () {
            const newName = $(this).text();
            const documentId = new URLSearchParams(window.location.search).get('id');

            fetch(`/update-template-name/${documentId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ newName }),
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        $('#save-status').text('Saved').fadeIn().delay(1000).fadeOut();
                    } else {
                        $('#save-status').text('Error saving').fadeIn().delay(1000).fadeOut();
                    }
                })
                .catch(error => console.error('Error updating template name:', error));
        });

        // Highlight all text in the template name field when it gains focus
        $('#template-name').on('focus', function () {
            const range = document.createRange();
            const selection = window.getSelection();
            range.selectNodeContents(this);
            selection.removeAllRanges();
            selection.addRange(range);
        });
    });

</script>
<!-- Add more section list -->
<script>
    // Upload image & function for draging sections
    document.addEventListener("DOMContentLoaded", function () {
        // Handle image upload
        const imageBox = document.getElementById("image-box");
        const imageUpload = document.createElement("input");
        imageUpload.type = "file";
        imageUpload.accept = "image/*";
        imageUpload.style.display = "none";

        imageBox.addEventListener("click", () => {
            imageUpload.click();
        });

        imageUpload.addEventListener("change", (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    imageBox.innerHTML = `<img src="${e.target.result}" alt="Uploaded Image">`;
                };
                reader.readAsDataURL(file);
            }
        });

        document.body.appendChild(imageUpload); // Append the input for image upload

        // Initialize Sortable for other sections
        const container = document.getElementById("draggable-container");
        Sortable.create(container, {
            handle: ".drag-handle", // Drag using the six-dot handle
            animation: 150,
            ghostClass: "dragging-ghost", // Add custom ghost class
            onStart: () => {
                // Collapse all sections during drag
                document.querySelectorAll(".content").forEach(content => {
                    content.style.display = "none";
                });
            },
            onEnd: () => {
                // Expand sections after drag ends
                document.querySelectorAll(".content").forEach(content => {
                    content.style.display = "block";
                });
            }
        });
    });

    // Global counter for leadership sections
    let leadershipCounter = 1;
    
    // Global counter for leadership sections
    let awardsCounter = 1;

    // Additional Section Templates
    const sectionTemplates = {
        awards: () => {
            // Generate a unique template with the current researchCounter
            const currentCounter = awardsCounter++;
            return `
                <div id="awards-section" class="section">
                    <div class="section-header">
                        <div class="section-title" style="display: flex;">
                            <p class="section-title">AWARDS & RECOGNITION</p>
                            <button class="add-button" data-tooltip="Add experience" onclick="addAwardsRow()"><i class="bi bi-plus-circle"></i></button>
                            <button class="remove-button" data-tooltip="Remove section" onclick="removeAwardsSection(this)"><i class="bi bi-x-circle"></i></button>
                        </div>
                        <div class="drag-handle"></div>
                    </div>
                    <div class="content">
                        <ul>
                            <div id="award1" class="award-row" style="display: flex; max-width: 100%; justify-content: space-between;">
                                <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Award/Recognition] for [Institution/Competition/Event Name]">[Award/Recognition] for [Institution/Competition/Event Name]</li>
                                <button class="remove-button" data-tooltip="Remove" onclick="removeAwardsRow(this)"><i class="bi bi-x-circle"></i></button>
                                <div class="date-container">
                                    <strong>(</strong>
                                    <div>
                                        <span id="year-date-display-41" class="date-display" onclick="openYearPicker(41)">Present</span>
                                        <div id="end-year-picker-41" class="year-picker" style="display: none;"></div>
                                    </div>
                                    <strong>)</strong>
                                </div>
                            </div>

                            <div id="award2" class="award-row" style="display: flex; max-width: 100%; justify-content: space-between;">
                                <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Award/Recognition]">[Award/Recognition]</li>
                                <button class="remove-button" data-tooltip="Remove" onclick="removeAwardsRow(this)"><i class="bi bi-x-circle"></i></button>
                                <div class="date-container">
                                    <strong>(</strong>
                                    <div>
                                        <span id="year-date-display-42" class="date-display" onclick="openYearPicker(42)">Present</span>
                                        <div id="end-year-picker-42" class="year-picker" style="display: none;"></div>
                                    </div>
                                    <strong>)</strong>
                                </div>
                            </div>
                        </ul>
                    </div>
                </div>
            `;
        }, 
        research: () => {
            return `
                <div class="section" id="research-section">
                    <div class="section-header">
                        <div class="section-title" style="display: flex;">
                            <p>RESEARCH PROJECTS</p>
                            <button class="add-button" data-tooltip="Add research" onclick="addResearch()"><i class="bi bi-plus-circle"></i></button>
                            <button class="remove-button" data-tooltip="Remove section" onclick="removeResearchSection(this)"><i class="bi bi-x-circle"></i></button>
                        </div>
                        <div class="drag-handle"></div>
                    </div>
                    <div id="research1" class="content">
                        <div class="research-name" style="display: flex; max-width: 100%; justify-content: space-between;">
                            <p style="width: 60%;" id="editable-text" class="editable-text placeholder bold" contenteditable="true" data-placeholder="[Research Name]"><b>[Research Name]</b></p>
                            <div class="date-container">
                                <strong>(</strong>
                                <div>
                                    <span id="start-date-display-41" class="date-display" onclick="openMonthPicker('start', 41)">Start Date</span>
                                    <div id="start-month-picker-41" class="month-picker" style="display: none;"></div>
                                </div>
                                <strong>-</strong>
                                <div>
                                    <span id="end-date-display-41" class="date-display" onclick="openMonthPicker('end', 41)">Present</span>
                                    <div id="end-month-picker-41" class="month-picker" style="display: none;"></div>
                                </div>
                                <strong>)</strong>
                            </div>
                            <button class="add-button1" data-tooltip="Add action" onclick="addResearchRow(1)"><i class="bi bi-plus-circle"></i></button>
                        </div>
                        <ul>
                            <div class="research-row">
                                <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] the [initiative/project] by [specific actions taken], resulting in [impact/outcome].">[Action] the [initiative/project] by [specific actions taken], resulting in [impact/outcome].</li>
                                <button class="remove-button" data-tooltip="Remove" onclick="removeResearchRow(this)"><i class="bi bi-x-circle"></i></button>
                             </div>
                            <div class="research-row">
                                <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] [process/tool] through [specific actions], achieving [measurable result].">[Action] [process/tool] through [specific actions], achieving [measurable result].</li>
                                <button class="remove-button" data-tooltip="Remove" onclick="removeResearchRow(this)"><i class="bi bi-x-circle"></i></button>
                            </div>
                            <div class="research-row">
                                <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] [feature/strategy] to [goal], improving [specific metric or outcome].">[Action] [feature/strategy] to [goal], improving [specific metric or outcome].</li>
                                <button class="remove-button" data-tooltip="Remove" onclick="removeResearchRow(this)"><i class="bi bi-x-circle"></i></button>
                             </div>
                            <div class="research-row">
                                <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] with [teams/stakeholders] to [task], enhancing [specific impact].">[Action] with [teams/stakeholders] to [task], enhancing [specific impact].</li>
                                <button class="remove-button" data-tooltip="Remove" onclick="removeResearchRow(this)"><i class="bi bi-x-circle"></i></button>
                            </div>
                        </ul>
                    </div>
                </div>
            `;
        },
        leadership: () => {
            return `
            <div class="section" id="leadership-section">
                <div class="section-header">
                    <div class="section-title" style="display: flex;">
                        <p>LEADERSHIP EXPERIENCE</p>
                        <button class="add-button" data-tooltip="Add experience" onclick="addLeadership()"><i class="bi bi-plus-circle"></i></button>
                        <button class="remove-button" data-tooltip="Remove section" onclick="removeLeadershipSection(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                    <div class="drag-handle"></div>
                </div>
                <div id="leadership1" class="content">
                    <div style="display: flex; max-width: 100%; justify-content: space-between;">
                        <p style="width: 60%;" id="editable-text" class="editable-text placeholder bold" contenteditable="true" data-placeholder="[Position] for [Institution/Event Name]"><b>[Position] for [Institution/Event Name]</b></p>
                        <button class="add-button1" data-tooltip="Add action" onclick="addLeadershipRow(1)"><i class="bi bi-plus-circle"></i></button>
                        <button class="remove-button1" data-tooltip="Remove section" onclick="removeLeadership(1)"><i class="bi bi-x-circle"></i></button>
                        <div class="date-container">
                            <strong>(</strong>
                            <div>
                                <span id="start-date-display-31" class="date-display" onclick="openMonthPicker('start', 31)">Start Date</span>
                                <div id="start-month-picker-31" class="month-picker" style="display: none;"></div>
                            </div>
                            <strong>-</strong>
                            <div>
                                <span id="end-date-display-31" class="date-display" onclick="openMonthPicker('end', 31)">Present</span>
                                <div id="end-month-picker-31" class="month-picker" style="display: none;"></div>
                            </div>
                            <strong>)</strong>
                        </div>
                    </div>
                    <ul>
                        <div class="leadership-row">
                            <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] the [initiative/project] by [specific actions taken], resulting in [impact/outcome].">[Action] the [initiative/project] by [specific actions taken], resulting in [impact/outcome].</li>
                            <button class="remove-button" data-tooltip="Remove" onclick="removeLeadershipRow(this)"><i class="bi bi-x-circle"></i></button>
                        </div>
                        <div class="leadership-row">
                            <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] [process/tool] through [specific actions], achieving [measurable result].">[Action] [process/tool] through [specific actions], achieving [measurable result].</li>
                            <button class="remove-button" data-tooltip="Remove" onclick="removeLeadershipRow(this)"><i class="bi bi-x-circle"></i></button>
                        </div>
                        <div class="leadership-row">
                            <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] [feature/strategy] to [goal], improving [specific metric or outcome].">[Action] [feature/strategy] to [goal], improving [specific metric or outcome].</li>
                            <button class="remove-button" data-tooltip="Remove" onclick="removeLeadershipRow(this)"><i class="bi bi-x-circle"></i></button>
                        </div>
                        <div class="leadership-row">
                            <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] with [teams/stakeholders] to [task], enhancing [specific impact].">[Action] with [teams/stakeholders] to [task], enhancing [specific impact].</li>
                            <button class="remove-button" data-tooltip="Remove" onclick="removeLeadershipRow(this)"><i class="bi bi-x-circle"></i></button>
                        </div>
                    </ul>
                </div>
            </div>
        `
    }};

    // Add Section Function
    function addSection(sectionType) {
        const container = document.getElementById('draggable-container');
        const template =
            typeof sectionTemplates[sectionType] === 'function'
                ? sectionTemplates[sectionType]()
                : sectionTemplates[sectionType];

        if (template) {
            container.insertAdjacentHTML('beforeend', template);
        } else {
            console.error(`Template for section type "${sectionType}" not found!`);
            return;
        }

        extendContainerHeightIfNeeded();
        attachEditableEvents();
        closeModal();
    }

    // Open Modal ( Additional Section List )
    function openModal() {
        document.getElementById('add-section-modal').style.display = 'block';
    }

    // Close Modal ( Additional Section List )
    function closeModal() {
        document.getElementById('add-section-modal').style.display = 'none';
    }

    // For all contenteditable elements to spellcheck="false", and paste as plain text only
    document.addEventListener("DOMContentLoaded", function () {
        // Select all elements with contenteditable="true"
        const editableElements = document.querySelectorAll('[contenteditable="true"]');

        // Function to strip formatting on paste
        function handlePaste(event) {
            // Prevent the default paste behavior
            event.preventDefault();

            // Get the plain text from the clipboard
            const plainText = (event.clipboardData || window.clipboardData).getData("text");

            // Insert the plain text into the contenteditable element
            document.execCommand("insertText", false, plainText);
        }

        // Function to set spellcheck="false"
        function setSpellCheckFalse(elements) {
            elements.forEach(element => {
                element.setAttribute("spellcheck", "false");
            });
        }

        // Attach paste event and set spellcheck="false" for existing elements
        setSpellCheckFalse(editableElements);
        editableElements.forEach(element => {
            element.addEventListener("paste", handlePaste);
        });

        // Monitor the DOM for dynamically added elements
        const observer = new MutationObserver(mutations => {
            mutations.forEach(mutation => {
                mutation.addedNodes.forEach(node => {
                    if (node.nodeType === 1 && node.hasAttribute("contenteditable") && node.getAttribute("contenteditable") === "true") {
                        // Set spellcheck="false"
                        node.setAttribute("spellcheck", "false");

                        // Attach paste event
                        node.addEventListener("paste", handlePaste);
                    }
                });
            });
        });

        // Start observing the body for changes
        observer.observe(document.body, { childList: true, subtree: true });
    });

</script>
<!-- Pagination -->
<script>
    const PAGE_HEIGHT = 297 * 3.77953; // A4 height in pixels
    const resumeContainer = document.getElementById("resume-container");
    const draggableContainer = document.getElementById("draggable-container");
    const addSectionButton = document.getElementById("add-section-button");
    const paginationContainer = document.getElementById("pagination-container");

    /**
     * Function 1: Extend the container height only when content exceeds its height.
     */
    function extendContainerHeightIfNeeded() {
        const contentHeight = draggableContainer.scrollHeight; // Total height of the content
        const containerHeight = resumeContainer.offsetHeight;

        if (contentHeight > containerHeight) {
            const newHeight = Math.ceil(contentHeight / PAGE_HEIGHT) * PAGE_HEIGHT;
            resumeContainer.style.minHeight = `${newHeight}px`;
            addPaginationLines();
        }
    }

    /**
     * Function 2: Add pagination lines with page numbers every 297mm (A4 height).
     */
    function addPaginationLines() {
        paginationContainer.innerHTML = ""; // Clear existing lines
        const totalHeight = resumeContainer.offsetHeight;
        const totalPages = Math.ceil(totalHeight / PAGE_HEIGHT);

        for (let i = 1; i < totalPages; i++) {
            const linePosition = i * PAGE_HEIGHT;
            const line = document.createElement("div");
            line.className = "pagination-line";
            line.style.top = `${linePosition}px`;
            line.innerHTML = `<span>Page ${i + 1}</span>`;
            paginationContainer.appendChild(line);
        }
    }

    /**
     * Initial Pagination Lines
     */
    addPaginationLines();
</script>
<!-- gpt generate & month picker -->
<script>
    // work experience form
    function showGptGenerateForm(id) {
        const form = document.getElementById(`gpt-generate-form-${id}`);
        form.style.display = 'block';
    }

    function closeGptForm(id) {
        const form = document.getElementById(`gpt-generate-form-${id}`);
        form.style.display = 'none';
        savePageContent();
    }

    async function generateExperience(id) {
        const form = document.getElementById(`gpt-generate-form-${id}`);
        const role = form.querySelector('.role').value.trim();
        const experienceSummary = form.querySelector('.experience-summary').value.trim();

        if (!role || !experienceSummary) {
            alert('Please fill out your role and experience summary.');
            return;
        }

        const placeholderMessage = form.querySelector('#placeholder-message');
        placeholderMessage.textContent = 'Generating suggestions... Please wait.';

        try {
            const response = await fetch('/generate-gpt-suggestions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    prompt: `Generate three bullet points for the role "${role}" based on the following summary: "${experienceSummary}". Each bullet point should be unique and highlight different aspects of the role.`,
                }),
            });

            if (!response.ok) {
                const errorData = await response.json();
                alert(errorData.error || 'An error occurred.');
                placeholderMessage.textContent = 'Error generating suggestions.';
                return;
            }

            const data = await response.json();
            if (data && Array.isArray(data)) {
                // Clear previous suggestions
                const suggestionsContainer = form.querySelector('.suggestion-options');
                suggestionsContainer.innerHTML = '';

                data.forEach((choice, index) => {
                    const suggestionDiv = document.createElement('label');
                    suggestionDiv.classList.add('bullet-point-option');

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.classList.add('bullet-checkbox');
                    checkbox.dataset.content = choice.message.content.trim();
                    checkbox.dataset.index = index;
                    checkbox.dataset.id = id;

                    const labelText = document.createElement('span');
                    labelText.textContent = choice.message.content.trim();

                    suggestionDiv.appendChild(checkbox);
                    suggestionDiv.appendChild(labelText);
                    suggestionsContainer.appendChild(suggestionDiv);

                    checkbox.addEventListener('change', function () {
                        if (checkbox.checked) {
                            checkbox.dataset.timestamp = Date.now(); // Set timestamp when checked
                        } else {
                            delete checkbox.dataset.timestamp; // Remove timestamp if unchecked
                        }
                        updateBulletPoints(id);
                    });
                });
            } else {
                placeholderMessage.textContent = "No suggestions found. Please try again.";
            }

        } catch (error) {
            console.error('Error generating experience descriptions:', error);
            placeholderMessage.textContent = 'Error occurred while generating suggestions.';
        }
    }

    // work experience form - Update bullet points to maintain order based on the time they were checked
    function updateBulletPoints(id) {
        const allCheckboxes = document.querySelectorAll(`#gpt-generate-form-${id} .bullet-checkbox`);
        const checkedChoices = Array.from(allCheckboxes).filter(cb => cb.checked);

        // Sort checked choices by timestamp
        checkedChoices.sort((a, b) => a.dataset.timestamp - b.dataset.timestamp);

            // Clear and reorder bullet points based on sorted checked choices
        for (let i = 0; i < 3; i++) {
            const bulletPoint = document.getElementById(`bullet-points-${id}-${i + 1}`);
            if (checkedChoices[i]) {
                bulletPoint.textContent = checkedChoices[i].dataset.content;
                bulletPoint.classList.remove('placeholder');
            } else {
                bulletPoint.textContent = `Bullet point ${i + 1}`;
                bulletPoint.classList.add('placeholder');
            }
        }

        savePageContent(); // Update the entire HTML content in the database
    }

    // projects form
    function showGptGenerateFormA(id, projectId) { 
        const form = document.getElementById(`gpt-generate-form-A${id}-${projectId}`); 
        if (form) {
            form.style.display = 'block';
        } else {
            console.error(`Form with id gpt-generate-form-A${id}-${projectId} not found.`);
        }
    }

    function closeGptFormA(id, projectId) { 
        const form = document.getElementById(`gpt-generate-form-A${id}-${projectId}`); 
        if (form) {
            form.style.display = 'none';
        }
    }

    async function generateExperienceA(id, projectId) {
        const form = document.getElementById(`gpt-generate-form-A${id}-${projectId}`);
        const role = form.querySelector('.role').value.trim();
        const experienceSummary = form.querySelector('.experience-summary').value.trim();

        if (!role || !experienceSummary) {
            alert('Please fill out your role and experience summary.');
            return;
        }

        const placeholderMessage = form.querySelector('#placeholder-messageA');
        placeholderMessage.textContent = 'Generating suggestions... Please wait.';

        try {
            const response = await fetch('/generate-gpt-suggestions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    prompt: `Generate three bullet points for the role "${role}" based on the following summary: "${experienceSummary}". Each bullet point should be unique and highlight different aspects of the role.`,
                }),
            });

            if (!response.ok) {
                const errorData = await response.json();
                alert(errorData.error || 'An error occurred.');
                placeholderMessage.textContent = 'Error generating suggestions.';
                return;
            }

            const data = await response.json();
            if (data && Array.isArray(data)) {
                // Clear previous suggestions
                const suggestionsContainer = form.querySelector('.suggestion-options');
                suggestionsContainer.innerHTML = '';

                data.forEach((choice, index) => {
                    const suggestionDiv = document.createElement('label');
                    suggestionDiv.classList.add('bullet-point-option');

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.classList.add('bullet-checkbox');
                    checkbox.dataset.content = choice.message.content.trim();
                    checkbox.dataset.index = index;
                    checkbox.dataset.id = id;

                    const labelText = document.createElement('span');
                    labelText.textContent = choice.message.content.trim();

                    suggestionDiv.appendChild(checkbox);
                    suggestionDiv.appendChild(labelText);
                    suggestionsContainer.appendChild(suggestionDiv);

                    checkbox.addEventListener('change', function () {
                        if (checkbox.checked) {
                            checkbox.dataset.timestamp = Date.now(); // Set timestamp when checked
                        } else {
                            delete checkbox.dataset.timestamp; // Remove timestamp if unchecked
                        }
                        updateBulletPointsA(id, projectId);
                    });
                });
            } else {
                placeholderMessage.textContent = "No suggestions found. Please try again.";
            }

        } catch (error) {
            console.error('Error generating experience descriptions:', error);
            placeholderMessage.textContent = 'Error occurred while generating suggestions.';
        }
    }

    //  projects form - Update bullet points to maintain order based on the time they were checked
    function updateBulletPointsA(id, projectId) {
        const allCheckboxes = document.querySelectorAll(`#gpt-generate-form-A${id}-${projectId} .bullet-checkbox`);
        const checkedChoices = Array.from(allCheckboxes).filter(cb => cb.checked);

        // Sort checked choices by timestamp
        checkedChoices.sort((a, b) => a.dataset.timestamp - b.dataset.timestamp);

            // Clear and reorder bullet points based on sorted checked choices
        for (let i = 0; i < 3; i++) {
            const bulletPoint = document.getElementById(`bullet-points-A${id}-${projectId}-${i + 1}`);
            if (checkedChoices[i]) {
                bulletPoint.textContent = checkedChoices[i].dataset.content;
                bulletPoint.classList.remove('placeholder');
            } else {
                bulletPoint.textContent = `Bullet point ${i + 1}`;
                bulletPoint.classList.add('placeholder');
            }
        }

        savePageContent(); // Update the entire HTML content in the database
    }



    let currentYear = new Date().getFullYear();

    function openMonthPicker(type, counter) {
        closeAllPickers();
        const monthPicker = document.getElementById(
            type === 'start' ? `start-month-picker-${counter}` : `end-month-picker-${counter}`
        );
        const otherPicker = document.getElementById(
            type === 'start' ? `end-month-picker-${counter}` : `start-month-picker-${counter}`
        );

        otherPicker.style.display = 'none'; // Close the other picker if open

        if (monthPicker.innerHTML.trim() === '') {
            generateMonthPicker(monthPicker, type, counter);
        }
        monthPicker.style.display = 'block';
    }

    function generateMonthPicker(container, type, counter) {
        container.innerHTML = `
            <div class="year">
                <span onclick="changeYear(-1, '${type}', ${counter})"><</span>
                <span id="${type}-year-display-${counter}">${currentYear}</span>
                <span onclick="changeYear(1, '${type}', ${counter})">></span>
            </div>
            <div class="months">
                ${['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
                    .map((month, index) =>
                        `<div class="month" onclick="selectMonth(${index}, '${type}', ${counter})">${month}</div>`
                    )
                    .join('')}
            </div>
            <div class="actions">
                <span class="action" onclick="clearDate('${type}', ${counter})">Clear</span>
                <span class="action" onclick="selectThisMonth('${type}', ${counter})">This Month</span>
            </div>
        `;
    }

    function changeYear(offset, type, counter) {
        const yearDisplay = document.getElementById(`${type}-year-display-${counter}`);
        currentYear = parseInt(yearDisplay.textContent) + offset;
        yearDisplay.textContent = currentYear;
    }

    function selectMonth(monthIndex, type, counter) {
        const displayElement = type === 'start'
            ? document.getElementById(`start-date-display-${counter}`)
            : document.getElementById(`end-date-display-${counter}`);

        const monthName = new Date(currentYear, monthIndex).toLocaleString('default', { month: 'long' });
        displayElement.textContent = `${monthName} ${currentYear}`;

        closeMonthPicker(type, counter);

        if (type === 'end' && displayElement.textContent === 'Present') {
            displayElement.textContent = 'Present';
        }

        savePageContent();
    }

    function clearDate(type, counter) {
        const displayElement = type === 'start'
            ? document.getElementById(`start-date-display-${counter}`)
            : document.getElementById(`end-date-display-${counter}`);

        if (type === 'end') {
            displayElement.textContent = 'Present';
        } else {
            displayElement.textContent = 'Select Start Date';
        }

        closeMonthPicker(type, counter);
        savePageContent();
    }

    function selectThisMonth(type, counter) {
        const monthIndex = new Date().getMonth();
        const year = new Date().getFullYear();

        const monthName = new Date(year, monthIndex).toLocaleString('default', { month: 'short' });

        const displayElement = type === 'start'
            ? document.getElementById(`start-date-display-${counter}`)
            : document.getElementById(`end-date-display-${counter}`);

        displayElement.textContent = `${monthName}, ${year}`;
        closeMonthPicker(type, counter);
        savePageContent();
    }

    function closeMonthPicker(type, counter) {
        const monthPicker = document.getElementById(
            type === 'start' ? `start-month-picker-${counter}` : `end-month-picker-${counter}`
        );
        monthPicker.style.display = 'none';
    }

    function openYearPicker(counter) {
        closeAllPickers();

        const yearPicker = document.getElementById(`end-year-picker-${counter}`);

        if (!yearPicker) {
            console.error("Year picker element not found!");
            return;
        }

        // Check if the year picker already has content
        if (yearPicker.innerHTML.trim() === '') {
            generateYearPicker(yearPicker, counter);
        }

        yearPicker.style.display = 'block';
    }

    function generateYearPicker(container, counter) {
        const currentYear = new Date().getFullYear();

        // Generate Year Picker UI
        container.innerHTML = `
            <div class="year-navigation">
                <span onclick="changeYear(-1, ${counter})">&lt;</span>
                <span id="year-display-${counter}">${currentYear}</span>
                <span onclick="changeYear(1, ${counter})">&gt;</span>
            </div>
            <div class="years">
                ${Array.from({ length: 12 }, (_, i) => currentYear - 6 + i)
                    .map((year) =>
                        `<div class="year" onclick="selectYear(${year}, ${counter})">${year}</div>`
                    )
                    .join('')}
            </div>
            <div class="actions">
                <span class="action" onclick="clearYear(${counter})">Clear</span>
                <span class="action" onclick="selectThisYear(${counter})">This Year</span>
            </div>
        `;
    }

    function changeYear(offset, counter) {
        const yearDisplay = document.getElementById(`year-display-${counter}`);
        const newYear = parseInt(yearDisplay.textContent) + offset;

        yearDisplay.textContent = newYear;

        // Update year options dynamically
        const yearsContainer = yearDisplay.parentNode.nextElementSibling;
        yearsContainer.innerHTML = Array.from({ length: 12 }, (_, i) => newYear - 6 + i)
            .map((year) =>
                `<div class="year" onclick="selectYear(${year}, ${counter})">${year}</div>`
            )
            .join('');
    }

    function selectYear(year, counter) {
        const displayElement = document.getElementById(`year-date-display-${counter}`);

        displayElement.textContent = `${year}`;
        closeYearPicker(counter);
        savePageContent();
    }

    function clearYear(counter) {
        const displayElement = document.getElementById(`year-date-display-${counter}`);

        displayElement.textContent = 'Present';
        closeYearPicker(counter);
        savePageContent();
    }

    function selectThisYear(counter) {
        const currentYear = new Date().getFullYear();
        const displayElement = document.getElementById(`year-date-display-${counter}`);

        displayElement.textContent = `${currentYear}`;
        closeYearPicker(counter);
        savePageContent();
    }

    function closeYearPicker(counter) {
        const yearPicker = document.getElementById(`end-year-picker-${counter}`);
        if (yearPicker) {
            yearPicker.style.display = 'none';
        }
    }

    function closeAllPickers() {
        // Close all open year and month pickers
        document.querySelectorAll('.year-picker').forEach(picker => (picker.style.display = 'none'));
        document.querySelectorAll('.month-picker').forEach(picker => (picker.style.display = 'none'));
    }

    document.addEventListener('click', (event) => {
        // Close all pickers if the click is outside of any picker or date display
        if (
            !event.target.closest('.year-picker') &&
            !event.target.closest('.month-picker') &&
            !event.target.closest('.date-display')
        ) {
            closeAllPickers();
        }
    });

    document.addEventListener("DOMContentLoaded", () => {
        const forms = document.querySelectorAll(".gpt-generate-form"); // Select all forms with the class

        forms.forEach((form) => {
            const dragHandle = form.querySelector(".drag-handle");

            let isDragging = false;
            let offsetX, offsetY;

            // Attach event listeners for dragging
            dragHandle.addEventListener("mousedown", (e) => {
                isDragging = true;
                form.classList.add("dragging");

                // Get cursor's offset relative to the form's top-left corner
                const rect = form.getBoundingClientRect();
                offsetX = e.clientX - rect.left;
                offsetY = e.clientY - rect.top;

                // Prevent text selection while dragging
                document.body.style.userSelect = "none";
            });

            document.addEventListener("mousemove", (e) => {
                if (isDragging) {
                    // Calculate new position
                    const left = e.clientX - offsetX;
                    const top = e.clientY - offsetY;

                    // Clamp to viewport boundaries
                    const viewportWidth = window.innerWidth;
                    const viewportHeight = window.innerHeight;

                    const formWidth = form.offsetWidth;
                    const formHeight = form.offsetHeight;

                    const clampedLeft = Math.max(0, Math.min(left, viewportWidth - formWidth));
                    const clampedTop = Math.max(0, Math.min(top, viewportHeight - formHeight));

                    // Apply new position
                    form.style.left = `${clampedLeft}px`;
                    form.style.top = `${clampedTop}px`;
                    form.style.transform = "none"; // Disable transform during dragging
                }
            });

            document.addEventListener("mouseup", () => {
                if (isDragging) {
                    isDragging = false;
                    form.classList.remove("dragging");
                    // Restore text selection
                    document.body.style.userSelect = "";
                }
            });
        });

        // Function to show the form
        window.showGptGenerateForm = function (id) {
            const form = document.getElementById(`gpt-generate-form-${id}`);
            if (form) {
                form.style.display = "block";
                form.style.left = "50%";
                form.style.top = "50%";
                form.style.transform = "translate(-50%, -50%)"; // Center it by default
            }
        };

        // Function to close the form
        window.closeGptForm = function (id) {
            const form = document.getElementById(`gpt-generate-form-${id}`);
            if (form) {
                form.style.display = "none";
            }
        };
    });

</script>
<!-- ruler -->
<script>    
    function addTick(position, size, symbol, number = null) {
        // Create a tick element
        const tick = document.createElement('div');
        tick.className = 'tick';
        tick.style.left = `${position}mm`;
        
        if (size === 'large') {
            tick.classList.add('large-tick');
        }
        
        // Set the tick symbol or number
        if (number !== null) {
            tick.textContent = number; // Display the number
        } else {
            tick.textContent = symbol; // Display the symbol
        }
        
        // Append to ruler
        document.getElementById('ruler').appendChild(tick);
    }

    // Loop to add ticks
    let numberLabel = 1; // Initialize the number counter
    for (let i = 0; i <= 210; i += 5) {
        if (i >= 10 && i <= 200 && i % 20 === 0) {
            addTick(i, 'large', '|', numberLabel); // Add a number every 20mm starting from 10mm
            numberLabel++; // Increment the number label
        } else if (i % 10 === 0) {
            addTick(i, 'large', '|'); // Large tick for every 10mm
        } else {
            addTick(i, 'small', '╵'); // Small tick for every 5mm
        }
    }

    let currentMarker = null;
    const minPadding = 10; // Minimum padding in mm
    const maxPadding = 30; // 40mm max padding on either side
    const mmToPxRatio = document.getElementById('ruler').offsetWidth / 210; // Convert mm to px

    document.getElementById('left-marker').addEventListener('mousedown', function () {
        currentMarker = 'left';
        document.getElementById('left-measure-line').style.display = 'block'; // Show the left line
    });

    document.getElementById('right-marker').addEventListener('mousedown', function () {
        currentMarker = 'right';
        document.getElementById('right-measure-line').style.display = 'block'; // Show the right line
    });

    document.addEventListener('mouseup', function () {
        if (currentMarker) {
            const leftLine = document.getElementById('left-measure-line');
            const rightLine = document.getElementById('right-measure-line');

            const pageElement = document.querySelector('page');

            // Apply padding changes when mouse is released
            if (currentMarker === 'left') {
                let newLeftPadding = Math.min(Math.max(parseInt(leftLine.style.left) / mmToPxRatio, minPadding), maxPadding);
                pageElement.style.paddingLeft = `${newLeftPadding}mm`;
            } else if (currentMarker === 'right') {
                let newRightPadding = Math.min(Math.max((document.getElementById('ruler').offsetWidth - parseInt(rightLine.style.left)) / mmToPxRatio, minPadding), maxPadding);
                pageElement.style.paddingRight = `${newRightPadding}mm`;
            }

            // Hide the lines
            leftLine.style.display = 'none';
            rightLine.style.display = 'none';
            currentMarker = null;
        }
    });

    document.addEventListener('mousemove', function (e) {
        if (currentMarker) {
            const rulerRect = document.getElementById('ruler').getBoundingClientRect();
            const mmToPxRatio = rulerRect.width / 210; // Convert mm to px

            if (currentMarker === 'left') {
                let newLeft = e.clientX - rulerRect.left;
                newLeft = Math.min(Math.max(newLeft, minPadding * mmToPxRatio), maxPadding * mmToPxRatio);
                document.getElementById('left-measure-line').style.left = newLeft + 'px';
                document.getElementById('left-marker').style.left = newLeft + 'px';
            } else if (currentMarker === 'right') {
                let newRight = e.clientX - rulerRect.left;
                newRight = Math.min(Math.max(newRight, (210 - maxPadding) * mmToPxRatio), rulerRect.width - minPadding * mmToPxRatio);
                document.getElementById('right-measure-line').style.left = newRight + 'px';
                document.getElementById('right-marker').style.left = newRight + 'px';
            }
        }
    });

    // Detect current font size when a contenteditable element is clicked
    document.addEventListener('click', function (e) {
        const target = e.target;

        if (target.hasAttribute('contenteditable')) {
            const computedFontSize = window.getComputedStyle(target).fontSize;
            const fontSizeDropdown = document.getElementById('font-size-dropdown');

            // Update the dropdown to reflect the current font size
            fontSizeDropdown.value = parseInt(computedFontSize) || 16; // Default to 16px if no font size
        }
    });

    // Function to set the font size for the selected text or entire contenteditable element
    function setFontSize() {
        const selection = window.getSelection();
        const fontSizeDropdown = document.getElementById('font-size-dropdown');
        const selectedValue = fontSizeDropdown.value;

        // Handle reset option
        if (selectedValue === 'reset') {
            if (selection.rangeCount && !selection.isCollapsed) {
                const activeElement = selection.anchorNode.parentElement.closest('[contenteditable="true"]');
                if (activeElement) {
                    activeElement.style.fontSize = ''; // Reset to default size
                }
            } else {
                const activeElement = document.activeElement;
                if (activeElement && activeElement.hasAttribute('contenteditable')) {
                    activeElement.style.fontSize = ''; // Reset to default size
                }
            }
            fontSizeDropdown.value = '16'; // Reset dropdown back to the default option
            return;
        }

        // If text is selected or an active contenteditable is clicked
        if (selection.rangeCount && !selection.isCollapsed) {
            const activeElement = selection.anchorNode.parentElement.closest('[contenteditable="true"]');
            if (activeElement) {
                activeElement.style.fontSize = `${selectedValue}px`;
            }
        } else {
            const activeElement = document.activeElement;
            if (activeElement && activeElement.hasAttribute('contenteditable')) {
                activeElement.style.fontSize = `${selectedValue}px`;
            }
        }
    }



    let currentLineHeight = 1.5;

    function changeLineHeight(amount) {
        currentLineHeight += amount;

        // Apply the new line height to all paragraphs within the main container
        const mainContainer = document.getElementById('resume-container');
        const paragraphs = mainContainer.querySelectorAll('.section [contenteditable]');

        paragraphs.forEach((p) => {
            p.style.lineHeight = currentLineHeight.toString();
        });
    }

    function resetLineHeight() {
        currentLineHeight = 1.5; // Default line height
        const mainContainer = document.getElementById('resume-container');
        const paragraphs = mainContainer.querySelectorAll('.section [contenteditable]');

        paragraphs.forEach((p) => {
            p.style.lineHeight = currentLineHeight.toString();
        });
    }
</script>
<!-- save as jspdf -->
<script>
    function saveAsPDF() {
        const pageElement = document.getElementById('resume-container');
        pageElement.classList.add('pdf-export');
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: 'a4',
        });

        pdf.setFont('Calibri', 'normal');

        pdf.html(pageElement, {
            callback: function (pdf) {
                pdf.save('template.pdf');
                pageElement.classList.remove('pdf-export');
            },
            x: 0,
            y: 0,
            width: 210,
            windowWidth: 800, // Ensure it matches your container's width
        });
    }


    // Attach the saveAsPDF function to a button click event
    document.getElementById('download-pdf').addEventListener('click', saveAsPDF);
</script>
<!-- add + remove -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const container = document.getElementById('main-container');
        Sortable.create(container, {
            handle: '.section-title', // Drag handle
            animation: 150, // Animation duration
            dragClass: 'no-shadow-drag', // Apply no-shadow class while dragging
        });
    });

    function addSkillRow() {
        const skillsContainer = document.querySelector(".skills-content");
        const skillRow = document.createElement("div");
        skillRow.classList.add("skill-row");
        skillRow.innerHTML = `
            <p id="editable-text" class="editable-text placeholder skill-category" contenteditable="true" data-placeholder="[Category]">[Category]</p>
            <strong>:</strong>
            <p id="editable-text" class="editable-text placeholder skill-detail" contenteditable="true" data-placeholder="[Skill 1], [Skill 2], [Skill 3]">[Skill 1], [Skill 2], [Skill 3]</p>
            <button class="remove-button" data-tooltip="Remove" onclick="removeSkillRow(this)"><i class="bi bi-x-circle"></i></button>
        `;
        skillsContainer.appendChild(skillRow);
        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    function removeSkillRow(button) {
        button.closest(".skill-row").remove();
        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    function removeWorkExperienceSection(button) {
        // Find the closest parent with id 'work-experience' and remove it
        const workExperienceSection = button.closest('#work-experience');
        if (workExperienceSection) {
            workExperienceSection.remove();
        }
        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    function removeObjectiveSection(button) {
        // Find the closest parent with id 'work-experience' and remove it
        const ObjectiveSection = button.closest('#objective');
        if (ObjectiveSection) {
            ObjectiveSection.remove();
        }
        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    function removeUniversitySection(button) {
        // Find the closest parent with id 'work-experience' and remove it
        const UniversitySection = button.closest('#education');
        if (UniversitySection) {
            UniversitySection.remove();
        }
        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    function removeSkillSection(button) {
        // Find the closest parent with id 'work-experience' and remove it
        const SkillSection = button.closest('#skills');
        if (SkillSection) {
            SkillSection.remove();
        }
        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    let workExperienceCounter = 1; // Start indexing from 0

    function addWorkExperience() {
        const workExperienceContainer = document.getElementById('work-experience');
        const workExperienceEntries = workExperienceContainer.querySelectorAll('[id^="work"]');
        const newSection = document.createElement('div');

        let maxId = 0;
        workExperienceEntries.forEach((entry) => {
            const idNumber = parseInt(entry.id.replace('work', ''), 10);
            if (!isNaN(idNumber) && idNumber > maxId) {
                maxId = idNumber;
            }
        });

        const workExperienceCounter = maxId + 1;

        const newWorkExperience = document.createElement('div');
        newWorkExperience.className = 'work-experience-entry';
        newWorkExperience.innerHTML = `
            <div id="work${workExperienceCounter}" class="content">
                <div style="display: flex; max-width: 100%; justify-content: space-between;">
                    <p style="width: 60%;" id="editable-text" class="editable-text placeholder bold" contenteditable="true" data-placeholder="[Company Name]">[Company Name]</p>
                    <button class="add-button1" onclick="addProject(${workExperienceCounter})" data-tooltip="Add more project"><i class="bi bi-plus-circle"></i></button>
                    <button class="remove-button1" data-tooltip="Remove section" onclick="removeWorkExperience(${workExperienceCounter})"><i class="bi bi-x-circle"></i></button>
                    <div class="date-container">
                        <strong>(</strong>
                        <div>
                            <span id="start-date-display-1${workExperienceCounter}" class="date-display" onclick="openMonthPicker('start', 1${workExperienceCounter})">Start Date</span>
                            <div id="start-month-picker-1${workExperienceCounter}" class="month-picker" style="display: none;"></div>
                        </div>
                        <strong>-</strong>
                        <div>
                            <span id="end-date-display-1${workExperienceCounter}" class="date-display" onclick="openMonthPicker('end', 1${workExperienceCounter})">Present</span>
                            <div id="end-month-picker-1${workExperienceCounter}" class="month-picker" style="display: none;"></div>
                        </div>
                        <strong>)</strong>
                    </div>
                </div>
                
                <p id="editable-text" class="editable-text placeholder italic" data-placeholder="[Job Title]" contenteditable="true">[Job Title]</p>
                <ul>
                    <li id="bullet-points-${workExperienceCounter}-1" class="editable-text placeholder" data-placeholder="Bullet point 1" contenteditable="true">Bullet point 1</li>
                    <li id="bullet-points-${workExperienceCounter}-2" class="editable-text placeholder" data-placeholder="Bullet point 2" contenteditable="true">Bullet point 2</li>
                    <li id="bullet-points-${workExperienceCounter}-3" class="editable-text placeholder" data-placeholder="Bullet point 3" contenteditable="true">Bullet point 3</li>
                    <button type="button" class="gpt-generate-btn" onclick="showGptGenerateForm(${workExperienceCounter})">AI Generate✨</button>
                </ul>
                <div class="projects-container">
                <!-- Projects will be added here -->
                </div>
                    
                <!-- work gpt form -->
                <div class="gpt-generate-form" id="gpt-generate-form-${workExperienceCounter}" style="display:none;">
                    <div class="form-header" style="display: flex; align-items: center; justify-content: space-between;">
                        <div class="drag-handle" title="Drag to move"></div>
                        <button class="close-btn" onclick="closeGptForm(${workExperienceCounter})">✕</button>
                    </div>
                    <div style="margin: 20px;">
                        <h1 style="font-size:30px; margin: 0;">Create work experience</h1>
                        <div class="form-group">
                            <label for="role">What was your role?</label>
                            <input type="text" class="role form-field" placeholder="e.g., Software Engineer">
                        </div>
                        <div class="form-group">
                            <label for="experience-summary">Your work experience in one sentence:</label>
                            <textarea class="experience-summary form-field" rows="2" placeholder="e.g., Led the development of a project to reduce manual tasks..."></textarea>
                        </div>
                        <div class="generate-btn-container">
                            <button type="button" class="generate-btn" onclick="generateExperience(${workExperienceCounter})">
                                <i class="fa-solid fa-bolt"></i> Generate
                            </button>
                        </div>
                    </div>
                    <div class="gpt-suggestions">
                        <div class="suggestion-options">
                            <p id="placeholder-message" style="color: #888;">Please enter your role and work experience above</p>
                            <!-- Generated suggestions with checkboxes will appear here -->
                        </div>
                    </div>
                </div>
            </div>
        `;
        workExperienceContainer.appendChild(newWorkExperience);

        attachEditableEvents();
        savePageContent();
        extendContainerHeightIfNeeded();
    }

    function removeWorkExperience(workExperienceCounter) {
        const workExperienceSection = document.getElementById(`work${workExperienceCounter}`);
        if (workExperienceSection) {
            workExperienceSection.remove(); // Remove the section from the DOM
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        } else {
            console.error(`Research section with ID research${workExperienceCounter} not found.`);
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        }
    }
    
    // Function to add a Project to a specific Work Experience
    function addProject(workExperienceId) {
        const projectsContainer = document.querySelector(`#work${workExperienceId} .projects-container`);

        // Get the highest existing project ID for the given workExperienceId
        const existingProjects = projectsContainer.querySelectorAll(".project");
        let maxProjectId = 0;

        existingProjects.forEach((project) => {
            const projectIdMatch = project.id.match(new RegExp(`project${workExperienceId}-(\\d+)`));
            if (projectIdMatch) {
                const id = parseInt(projectIdMatch[1], 10);
                if (id > maxProjectId) maxProjectId = id;
            }
        });

        // Increment the highest project ID for the new project
        const newProjectId = maxProjectId + 1;

        // New Project HTML
        const newProjectHTML = `
            <div class="project" id="project${workExperienceId}-${newProjectId}" style="margin-top: 10px; padding-left: 20px;">
                <div style="display: flex; flex-direction: column;">
                    <p style="font-weight: bold; margin-bottom: 1mm;">Project :</p>
                    <p id="editable-text" class="editable-text placeholder bold" data-placeholder="[Project Name]" contenteditable="true" class="bold">[Project Name]</p>
                </div>
                <ul>
                    <li id="bullet-points-A${workExperienceId}-${newProjectId}-1" class="editable-text placeholder" data-placeholder="Project bullet point 1" contenteditable="true">Project bullet point 1</li>
                    <li id="bullet-points-A${workExperienceId}-${newProjectId}-2" class="editable-text placeholder" data-placeholder="Project bullet point 2" contenteditable="true">Project bullet point 2</li>
                    <li id="bullet-points-A${workExperienceId}-${newProjectId}-3" class="editable-text placeholder" data-placeholder="Project bullet point 3" contenteditable="true">Project bullet point 3</li>
                    <button type="button" class="gpt-generate-btn" onclick="showGptGenerateFormA(${workExperienceId}, ${newProjectId})">AI Generate✨</button>
                </ul>
                <!-- project gpt form -->
                <div class="gpt-generate-form" id="gpt-generate-form-A${workExperienceId}-${newProjectId}" style="display:none;">
                    <div class="form-header" style="display: flex; align-items: center; justify-content: space-between;">
                        <div class="drag-handle" title="Drag to move"></div>
                        <button class="close-btn" onclick="closeGptFormA(${workExperienceId}, ${newProjectId})">✕</button>
                    </div>
                    <div style="margin: 20px;">
                        <h1 style="font-size:30px; margin: 0;">Create work experience</h1>
                        <div class="form-group">
                            <label for="role">What was your role?</label>
                            <input type="text" class="role form-field" placeholder="e.g., Software Engineer">
                        </div>
                        <div class="form-group">
                            <label for="experience-summary">Your work experience in one sentence:</label>
                            <textarea class="experience-summary form-field" rows="2" placeholder="e.g., Led the development of a project to reduce manual tasks..."></textarea>
                        </div>
                        <div class="generate-btn-container">
                            <button type="button" class="generate-btn" onclick="generateExperienceA(${workExperienceId}, ${newProjectId})">
                                <i class="fa-solid fa-bolt"></i> Generate
                            </button>
                        </div>
                    </div>
                    <div class="gpt-suggestions">
                        <div class="suggestion-options">
                            <p id="placeholder-messageA" style="color: #888;">Please enter your role and work experience above</p>
                            <!-- Generated suggestions with checkboxes will appear here -->
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Append the new project to the container
        projectsContainer.insertAdjacentHTML("beforeend", newProjectHTML);
        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    let universityCounter = 1; // Counter for dynamically created university sections

    function addUniversity() {
        const educationContainer = document.getElementById('education');
        const educationEntries = educationContainer.querySelectorAll('[id^="university"]'); // Select all elements with id starting with "university"
        const newSection = document.createElement('div');

        // Dynamically calculate the next available ID
        let maxId = 0;
        educationEntries.forEach(entry => {
            const idNumber = parseInt(entry.id.replace('university', ''), 10); // Extract the number from the ID
            if (!isNaN(idNumber) && idNumber > maxId) {
                maxId = idNumber;
            }
        });

        // Set the counter to the next available ID
        universityCounter = maxId + 1;

        newSection.id = `university${universityCounter}`;
        newSection.className = 'content';
        newSection.innerHTML = `
            <div style="display: flex; max-width: 100%; justify-content: space-between;">
                <p style="width: 60%;" id="editable-text" class="editable-text placeholder bold" data-placeholder="[Institution Name]" spellcheck="false" contenteditable="true">[Institution Name]</p>
                <div class="date-container">
                    <strong>(</strong>
                    <div>
                        <span id="start-date-display-2${universityCounter}" class="date-display" onclick="openMonthPicker('start', 2${universityCounter})">Start Date</span>
                        <div id="start-month-picker-2${universityCounter}" class="month-picker" style="display: none;"></div>
                    </div>
                    <strong>-</strong>
                    <div>
                        <span id="end-date-display-2${universityCounter}" class="date-display" onclick="openMonthPicker('end', 2${universityCounter})">Present</span>
                        <div id="end-month-picker-2${universityCounter}" class="month-picker" style="display: none;"></div>
                    </div>
                    <strong>)</strong>
                </div>
            </div>
            <p id="editable-text" class="editable-text placeholder" data-placeholder="[Degree Name]" contenteditable="true">[Degree Name]</p>
        `;

        educationContainer.appendChild(newSection);

        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    function removeUniversity(id) {
        const university = document.getElementById(`university${id}`);
        if (university) {
            university.remove();
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        }
    }

    let leadershipRowCounter = 1;
    let researchCounter = 1; // Counter for research sections

    // Function to add a new research section
    function addResearch() {
        researchCounter++; // Increment the counter
        const researchContainer = document.getElementById('research-section'); // Main research container
        const newResearchHTML = `
            <div id="research${researchCounter}" class="content">
                <div style="display: flex; max-width: 100%; justify-content: space-between;">
                    <p style="width: 60%;" id="editable-text" class="editable-text placeholder bold" contenteditable="true" data-placeholder="[Research Name]"><b>[Research Name]</b></p>
                    <button class="add-button1" data-tooltip="Add action" onclick="addResearchRow(${researchCounter})"><i class="bi bi-plus-circle"></i></button>
                    <button class="remove-button1" data-tooltip="Remove section" onclick="removeResearch(${researchCounter})"><i class="bi bi-x-circle"></i></button>
                    <div class="date-container">
                        <strong>(</strong>
                        <div>
                            <span id="start-date-display-4${researchCounter}" class="date-display" onclick="openMonthPicker('start', 4${researchCounter})">Start Date</span>
                            <div id="start-month-picker-4${researchCounter}" class="month-picker" style="display: none;"></div>
                        </div>
                        <strong>-</strong>
                        <div>
                            <span id="end-date-display-4${researchCounter}" class="date-display" onclick="openMonthPicker('end', 4${researchCounter})">Present</span>
                            <div id="end-month-picker-4${researchCounter}" class="month-picker" style="display: none;"></div>
                        </div>
                        <strong>)</strong>
                    </div>
                </div>
                <ul>
                    <div class="research-row">
                        <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] the [initiative/project] by [specific actions taken], resulting in [impact/outcome].">[Action] the [initiative/project] by [specific actions taken], resulting in [impact/outcome].</li>
                        <button class="remove-button" data-tooltip="Remove" onclick="removeResearchRow(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                    <div class="research-row">
                        <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] [process/tool] through [specific actions], achieving [measurable result].">[Action] [process/tool] through [specific actions], achieving [measurable result].</li>
                        <button class="remove-button" data-tooltip="Remove" onclick="removeResearchRow(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                    <div class="research-row">
                        <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] [feature/strategy] to [goal], improving [specific metric or outcome].">[Action] [feature/strategy] to [goal], improving [specific metric or outcome].</li>
                        <button class="remove-button" data-tooltip="Remove" onclick="removeResearchRow(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                    <div class="research-row">
                        <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] with [teams/stakeholders] to [task], enhancing [specific impact].">[Action] with [teams/stakeholders] to [task], enhancing [specific impact].</li>
                        <button class="remove-button" data-tooltip="Remove" onclick="removeResearchRow(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                </ul>
            </div>
        `;

        // Append the new research section
        researchContainer.insertAdjacentHTML('beforeend', newResearchHTML);
        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    // Function to remove a specific research section
    function removeResearch(researchId) {
        const researchSection = document.getElementById(`research${researchId}`);
        if (researchSection) {
            researchSection.remove(); // Remove the section from the DOM
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        } else {
            console.error(`Research section with ID research${researchId} not found.`);
        }
    }

    // Function to add a new row to a specific research section
    function addResearchRow(researchId) {
        const researchContent = document.getElementById(`research${researchId}`).querySelector('ul');
        const newResearchRow = `
            <div class="research-row">
                <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] [initiative/project] by [specific actions taken], resulting in [impact/outcome].">[Action] [initiative/project] by [specific actions taken], resulting in [impact/outcome].</li>
                <button class="remove-button" data-tooltip="Remove" onclick="removeResearchRow(this)"><i class="bi bi-x-circle"></i></button>
            </div>
        `;

        // Append the new row to the research section
        researchContent.insertAdjacentHTML('beforeend', newResearchRow);
        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    // Function to remove a specific research row
    function removeResearchRow(button) {
        const researchRow = button.closest('.research-row');
        if (researchRow) {
            researchRow.remove(); // Remove the row
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        }
    }

    // Function to add a new leadership section
    function addLeadership() {
        leadershipCounter++; // Increment the counter
        const leadershipContainer = document.getElementById('leadership-section'); // Main leadership container
        const newLeadershipHTML = `
            <div id="leadership${leadershipCounter}" class="content">
                <div style="display: flex; max-width: 100%; justify-content: space-between;">
                    <p style="width: 60%;" id="editable-text" class="editable-text placeholder bold" contenteditable="true" data-placeholder="[Position] for [Institution/Event Name]"><b>[Position] for [Institution/Event Name]</b></p>
                    <button class="add-button1" data-tooltip="Add action" onclick="addLeadershipRow(${leadershipCounter})"><i class="bi bi-plus-circle"></i></button>
                    <button class="remove-button1" data-tooltip="Remove section" onclick="removeLeadership(${leadershipCounter})"><i class="bi bi-x-circle"></i></button>
                    <div class="date-container">
                        <strong>(</strong>
                        <div>
                            <span id="start-date-display-3${leadershipCounter}" class="date-display" onclick="openMonthPicker('start', 3${leadershipCounter})">Start Date</span>
                            <div id="start-month-picker-3${leadershipCounter}" class="month-picker" style="display: none;"></div>
                        </div>
                        <strong>-</strong>
                        <div>
                            <span id="end-date-display-3${leadershipCounter}" class="date-display" onclick="openMonthPicker('end', 3${leadershipCounter})">Present</span>
                            <div id="end-month-picker-3${leadershipCounter}" class="month-picker" style="display: none;"></div>
                        </div>
                        <strong>)</strong>
                    </div>
                </div>
                <ul>
                    <div class="leadership-row">
                        <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] the [initiative/project] by [specific actions taken], resulting in [impact/outcome].">[Action] the [initiative/project] by [specific actions taken], resulting in [impact/outcome].</li>
                        <button class="remove-button" data-tooltip="Remove" onclick="removeLeadershipRow(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                    <div class="leadership-row">
                        <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] [process/tool] through [specific actions], achieving [measurable result].">[Action] [process/tool] through [specific actions], achieving [measurable result].</li>
                        <button class="remove-button" data-tooltip="Remove" onclick="removeLeadershipRow(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                    <div class="leadership-row">
                        <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] [feature/strategy] to [goal], improving [specific metric or outcome].">[Action] [feature/strategy] to [goal], improving [specific metric or outcome].</li>
                        <button class="remove-button" data-tooltip="Remove" onclick="removeLeadershipRow(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                    <div class="leadership-row">
                        <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] with [teams/stakeholders] to [task], enhancing [specific impact].">[Action] with [teams/stakeholders] to [task], enhancing [specific impact].</li>
                        <button class="remove-button" data-tooltip="Remove" onclick="removeLeadershipRow(this)"><i class="bi bi-x-circle"></i></button>
                    </div>
                </ul>
            </div>
        `;

        // Append the new leadership section
        leadershipContainer.insertAdjacentHTML('beforeend', newLeadershipHTML);
        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    // Function to remove a specific leadership section
    function removeLeadership(leadershipId) {
        const leadershipSection = document.getElementById(`leadership${leadershipId}`);
        if (leadershipSection) {
            leadershipSection.remove(); // Remove the section from the DOM
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        } else {
            console.error(`Leadership section with ID leadership${leadershipId} not found.`);
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        }
    }

    // Function to add a new row to a specific leadership section
    function addLeadershipRow(leadershipId) {
        const leadershipContent = document.getElementById(`leadership${leadershipId}`).querySelector('ul');
        const newLeadershipRow = `
            <div class="leadership-row">
                <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Action] [initiative/project] by [specific actions taken], resulting in [impact/outcome].">[Action] [initiative/project] by [specific actions taken], resulting in [impact/outcome].</li>
                <button class="remove-button" data-tooltip="Remove" onclick="removeLeadershipRow(this)"><i class="bi bi-x-circle"></i></button>
            </div>
        `;

        // Append the new row to the leadership section
        leadershipContent.insertAdjacentHTML('beforeend', newLeadershipRow);
        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    // Function to remove a specific leadership row
    function removeLeadershipRow(button) {
        const leadershipRow = button.closest('.leadership-row');
        if (leadershipRow) {
            leadershipRow.remove(); // Remove the row
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        }
    }

    /**
     * Remove a leadership section dynamically.
     */
    function removeLeadershipSection(button) {
        const section = button.closest(".section");
        if (section) {
            section.remove();
            console.log("Leadership section removed.");
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        } else {
            console.error("Unable to find leadership section to remove.");
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        }
    }

    /**
     * Remove a research section dynamically.
     */
    function removeResearchSection(button) {
        const section = button.closest(".section");
        if (section) {
            section.remove();
            console.log("Research section removed.");
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        } else {
            console.error("Unable to find research section to remove.");
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        }
    }

    function removeAwardsRow(button) {
        button.closest(".award-row").remove();
        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    let awardCounter = 2; // Initialize the awardCounter to the next available number

    function addAwardsRow() {
        // Increment the counter for the next row
        awardCounter++;
        const awardsContainer = document.querySelector("#awards-section .content > ul");

        if (!awardsContainer) {
            console.error("Awards container not found!");
            return;
        }

        // Create a new award row with a unique ID
        const newAwardRow = `
            <div id="award${awardCounter}" class="award-row" style="display: flex; max-width: 100%; justify-content: space-between;">
                <li id="editable-text" class="editable-text placeholder" contenteditable="true" data-placeholder="[Award/Recognition] for [Institution/Competition/Event Name]">
                    [Award/Recognition] for [Institution/Competition/Event Name]
                </li>
                <button class="remove-button" data-tooltip="Remove" onclick="removeAwardsRow(this)"><i class="bi bi-x-circle"></i></button>
                <div class="date-container">
                    <strong>(</strong>
                    <div>
                        <span id="year-date-display-4${awardCounter}" class="date-display" onclick="openYearPicker(4${awardCounter})">Present</span>
                        <div id="end-year-picker-4${awardCounter}" class="year-picker" style="display: none;"></div>
                    </div>
                    <strong>)</strong>
                </div>
            </div>
        `;

        // Append the new award row to the ul inside #awards-section
        awardsContainer.insertAdjacentHTML("beforeend", newAwardRow);

        attachEditableEvents(); // Reattach listeners to new elements
        savePageContent(); // Save changes to the page
        extendContainerHeightIfNeeded();
    }

    function removeAwardsSection(button) {
        // Find the closest section container
        const awardsSection = document.getElementById("awards-section");

        if (awardsSection) {
            awardsSection.remove(); // Remove the awards section from the DOM
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        } else {
            console.error("Awards section not found!");
            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            extendContainerHeightIfNeeded();
        }
    }

</script>
<!-- attach Editable Events -->
<script>
    // Function to attach events to editable elements
    function attachEditableEvents() {
            const editableElements = document.querySelectorAll('.editable-text, .bullet-points');

            // Handle contenteditable fields
            editableElements.forEach((el) => {
                el.addEventListener('focus', function () {
                    if (el.innerText === el.dataset.placeholder) {
                        el.innerText = '';
                        el.classList.remove('placeholder');
                    }
                });

                el.addEventListener('blur', function () {
                    if (el.innerText.trim() === '') {
                        el.innerText = el.dataset.placeholder;
                        el.classList.add('placeholder');
                    }
                });

                el.addEventListener('input', function () {
                    el.classList.toggle('placeholder', el.innerText.trim() === '');
                    triggerAutoSave();
                });
            });
        }

    // Save the entire <page> content
    function savePageContent() {
        const content = document.querySelector('#resume-container').innerHTML;
        const documentId = new URLSearchParams(window.location.search).get('id');

        fetch(`/save/${documentId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content }),
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Content saved successfully!');

                    // Trigger the screenshot update
                    fetch(`/save-screenshot/${documentId}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ content }),
                    })
                        .then(response => response.json())
                        .then(screenshotData => {
                            if (screenshotData.success) {
                                console.log('Screenshot updated successfully!');
                            } else {
                                console.error('Screenshot update failed:', screenshotData.error);
                            }
                        })
                        .catch(error => console.error('Screenshot error:', error));
                } else {
                    console.error('Save error:', data.error);
                }
            })
            .catch(error => console.error('Save content error:', error));
    }

    // Auto-save functionality (debounced to save after 1 second of inactivity)
    let saveTimeout;

    function triggerAutoSave() {
        clearTimeout(saveTimeout); // Clear the previous timeout
        saveTimeout = setTimeout(savePageContent, 1000); // Save the entire <page> after 1 second of inactivity
    }

    // Call attachEditableEvents on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', attachEditableEvents);

    function handlePlaceholder(el) {
        el.addEventListener('focus', function () {
            if (el.innerText === el.dataset.placeholder) {
                el.innerText = '';
                el.classList.remove('placeholder');
            }
        });

        el.addEventListener('blur', function () {
            if (el.innerText.trim() === '') {
                el.innerText = el.dataset.placeholder;
                el.classList.add('placeholder');
            }
        });
    }
</script>
<!-- alert to upgrade plan -->
<script>
    function showUpgradeAlert() {
        // Check if an alert already exists to avoid duplicates
        let existingAlert = document.getElementById('upgrade-alert');
        if (existingAlert) return;

        // Create the alert container
        const alertContainer = document.createElement('div');
        alertContainer.id = 'upgrade-alert';
        alertContainer.style.cssText = `
            background-color: #ffe5e5;
            border: 1px solid #f5c2c2;
            color: #a94442;
            padding: 15px;
            margin: 20px auto;
            border-radius: 5px;
            text-align: center;
            width: 80%;
            max-width: 500px;
            position: relative;
        `;

        // Add alert message
        const message = document.createElement('p');
        message.textContent = 'No prompts remaining. Please upgrade your plan to continue.';
        alertContainer.appendChild(message);

        // Add "Upgrade Now" button
        const upgradeButton = document.createElement('button');
        upgradeButton.textContent = 'Upgrade Now';
        upgradeButton.style.cssText = `
            background-color: #007bff;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        `;
        upgradeButton.onclick = function () {
            window.location.href = '/'; // Redirect to the upgrade page
        };
        alertContainer.appendChild(upgradeButton);

        // Add a close button
        const closeButton = document.createElement('span');
        closeButton.textContent = '×';
        closeButton.style.cssText = `
            position: absolute;
            top: 10px;
            right: 15px;
            cursor: pointer;
            font-size: 20px;
        `;
        closeButton.onclick = function () {
            alertContainer.remove(); // Remove the alert when close button is clicked
        };
        alertContainer.appendChild(closeButton);

        // Append the alert container to the body or a specific container
        const mainContainer = document.getElementById('main-container') || document.body;
        mainContainer.prepend(alertContainer);
    }

</script>
</body>
</html>
