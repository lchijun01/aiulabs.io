<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Resume AI - Aiulabs.io</title>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.0/jspdf.umd.min.js"></script>
    <script>
        $(document).ready(function() {
            const urlParams = new URLSearchParams(window.location.search);
            const templateId = urlParams.get('templateId');
        
            if (templateId) {
                loadTemplateContent(templateId); // Load specific template content using its ID
            }
        });
    </script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/views/css/resume.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Niramit:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200..700&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://kit.fontawesome.com/332cfc7815.js" crossorigin="anonymous"></script>
    <link href="/views/images/favicon.png" rel="shortcut icon" type="image/x-icon">
    <link href="/views/images/webclip.png" rel="apple-touch-icon">
    <style>
        * {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            font-size: 12px;
        }
        page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            display: block;
            margin: 0 auto;
            position: relative;
            box-sizing: border-box; /* Ensures padding doesn't increase element size */
            padding-left: 10mm; /* Initial padding */
            padding-right: 10mm; /* Initial padding */
            padding-top: 10mm;
            overflow: hidden; /* Hide overflow content */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        .draggable {
            width: 100%;
            height: 85vh;
            display: block;
            padding-top: 100px;
            justify-content: center;
            overflow-y: auto;
        }
        /* Webkit browsers (Chrome, Safari, Edge) */
        .draggable::-webkit-scrollbar {
            width: 5px;
        }
        .draggable::-webkit-scrollbar-track {
            background: #eaeaea;
        }
        .draggable::-webkit-scrollbar-thumb {
            background: #b3b3b3;
            border-radius: 10px;
        }
        /* Firefox Scrollbar Styling */
        .draggable {
            scrollbar-width: thin;
            scrollbar-color: #b3b3b3 #f0f0f0;
        }
        page[size="A4"] {
            width: 21cm;
            height: 29.7cm;
            background: white;
            display: block;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            box-sizing: border-box;
            padding: 10mm;
        }
        body {
            background: #333144;
            margin: 0;
            font-family: Arial, sans-serif;
            overflow-y: scroll;
        }
        @page {
            size: 21cm 29.7cm;
            margin: 0mm;
        }
        .sets {
            display: flex;
            margin-left: 5px;
            padding-left: 5px;
        }
        .sets button {
            background-color: transparent;
            border: 0;
            cursor: pointer;
            padding: 2mm 3mm;
            color: white;
        }
        .sets button:hover {
            background-color: #272636;
        }
        .sets select {
            padding: 2mm 3mm;
            background-color: transparent;
            border: 0;
            border-radius: 8px;
            cursor: pointer;
            color: white;
        }
        .sets select:hover {
            background-color: #272636;
        }
        .sets select:hover  option{
            background-color: #272636;
        }
        .button-container {
            width: 100px;
        }
        .button-container button {
            border: 0;
            border-radius: 5px;
            background-color: rgb(226, 210, 242);
            width: 100px;
            height: 40px;
            font-weight: bold;
            cursor: pointer;
        }
        .button-container p {
            width: auto;
            max-width: 200px;
            position: absolute;
            border: 0;
            top: 10px;
            left: 10%;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            font-size: 20px;
            border-bottom: 1px solid black !important;
            color: black !important;
            padding: 2mm;
        }
        .draggable-section {
            padding: 1mm 0;
            margin-bottom: 5mm;
            cursor: move;
        }
        #ruler {
            position: relative;
            width: 21cm;
            height: 20px;
            background: #272636;
            margin: 0 auto;
            display: flex;
            align-items: center;
            user-select: none;
        }
        .draggable-section .editable-text,
        .draggable-section .bullet-points {
            cursor: text; /* Default text cursor for editable content */
        }
        .draggable-section:hover .drag-handle {
            color: #333;
        }
        .tick {
            position: absolute;
            height: 100%;
            color: #9a9a9a;
            font-size: 10px;
            line-height: 20px;
        }
        .draggable-marker {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 12px solid #ff0000; /* Triangle color */
            cursor: ew-resize;
            transform: translateX(-50%); /* Center align the triangle */
            z-index: 30; /* Higher z-index to ensure it's above other elements */
        }
        #left-marker {
            left: 10mm; /* Default padding for left */
        }
        #right-marker {
            left: calc(210mm - 10mm); /* Default position for right marker */
        }
        .measure-line {
            position: absolute;
            width: 0.2px;
            min-height: 100vh;
            background-color: #ff0000;
            display: none;
            top: 0;
            left: 10mm;
            z-index: 20;
        }
        th {
            text-align: left;
        }
        td {
            display: flex;
        }
        tr strong {
            margin-left: 2mm;
            margin-right: 1mm;
            font-size: 11px;
        }
        tr p {
            width: 10cm !important;
            max-width: 15cm !important;
        }
        .placeholder {
            color: #cecece !important; /* Placeholder text color */
        }
        .editable-text {
            width: 100%;
            border-bottom: 1px solid transparent !important; /* Default state */
            transition: background-color 0.3s, border-bottom-color 0.3s;
            outline: none;
            color: #000; /* Default text color */
            outline: none;
            border: none;
            font-size: 11px;
        }
        .editable-text:focus {
            background-color: #fef0ff;
            border-bottom-color: #580067 !important;
            outline: none;
        }
        .bullet-points {
            width: 100%;
            border-bottom: 1px solid transparent !important; /* Default state */
            transition: background-color 0.3s, border-bottom-color 0.3s;
            outline: none;
            color: #000; /* Default text color */
            outline: none; 
            border: none;
            font-size: 11px;
        }
        .bullet-points:focus {
            background-color: #fef0ff;
            border-bottom-color: #580067 !important;
            outline: none;
        }
        .section-title {
            border-bottom: 1px solid black;
            margin-bottom: 1mm;
            cursor: move;
            white-space: normal;
        }
        .section-title p {
            color: #043579;
            font-weight: bold;
            font-size: 14px;
            margin-right: 10px;
        }
        .section p {
            line-height: 1.5;
        }
        .add-button {
            border: none;
            cursor: pointer;
            text-align: center;
            display: flex;
            position: relative;
            color: grey;
            background: 0;
            align-items: center;
            margin-left: 2mm;
        }
        .add-button:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%; /* Position above the button */
            left: 50%;
            transform: translateX(-50%);
            background-color: #1a1a1a;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
            white-space: nowrap;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            font-size: 12px;
            opacity: 1;
            z-index: 10;
        }
        .remove-button {
            border: none;
            cursor: pointer;
            text-align: center;
            display: flex;
            position: relative;
            color: rgb(255, 0, 0);
            background: 0;
            align-items: center;
            margin-left: 2mm;
        }
        .remove-button:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1a1a1a;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
            white-space: nowrap;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            font-size: 12px;
            opacity: 1;
            z-index: 10;
        }
        .section-title .remove-button, .section-title .add-button {
            display: none; /* Hide the remove button by default */
        }
        .section-title:hover .remove-button, .section-title:hover .add-button {
            display: inline-flex; /* Display the remove button when hovering over .section-title p */
        }
        .ul:hover .gpt-generate-btn {
            display: inline-block;
        }
        .gpt-generate-form {
            width: 50vh;
            margin-top: 10px;
            border-radius: 10px;
            background-color: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            font-family: Arial, sans-serif;
            position: relative; /* Added to contain the close button positioning */
            position: fixed;
            left: 2%;
            top: 20%;
        }
        .ul {
            position: relative; /* Ensures button positioning within the UL */
            padding-left: 20px;
        }
        .gpt-generate-btn {
            position: absolute;
            top: 50%; /* Center vertically relative to UL */
            left: 50%; /* Center horizontally relative to UL */
            transform: translate(-50%, -50%); /* Adjusts position to align with the center */
            z-index: 10; /* Ensures button is on top */
            display: flex;
            align-items: center;
            padding: 5px 10px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            color: #ffffff;
            cursor: pointer;
            background: linear-gradient(45deg, #ff0077, #9b00e5);
            transition: transform 0.2s ease-in-out;
            outline: none;
        }
        .ul:hover .gpt-generate-btn {
            display: flex; /* Ensures visibility on hover */
        }
        .gpt-generate-form h2 {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 8px;
            color: #333;
        }
        .form-field {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-field:focus {
            border-color: #DD00AC;
            outline: none;
        }
        textarea.form-field {
            resize: none;
        }
        .gpt-suggestions {
            border-top: 1px solid #ddd;
            background-color: #DEDEDE;
            padding: 20px;
        }
        .suggestion {
            display: flex;
            align-items: center;
            margin-bottom: 10px; /* Add margin to separate each suggestion */
            padding-left: 10px;
        }
        .suggestion span {
            font-size: 14px;
            color: #333;
            padding-left: 10px;
        }
        /* Close button style */
        .form-header {
            display: flex;
            align-items: center;
            justify-content: space-between; /* Aligns the close button to the top-right */
            margin-bottom: 20px; /* Adds some space below the header */
        }
        .close-btn {
            background-color: transparent;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #888;
            transition: color 0.3s;
            position: absolute;
            top: 20px;
            right: 20px; /* Adjusts to the right within the form */
        }
        .close-btn:hover {
            color: #333;
        }
        .gpt-generate-form h1 {
            margin: 0;
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        #save-status {
            margin-left: 10px;
            color: green;
            padding-bottom: 20px;
        }
        .bullet-point-option {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            cursor: pointer; /* Makes the row clickable */
            transition: background-color 0.2s;
            background-color: #f9f9f9;
        }
        .bullet-point-option:hover {
            background-color: #f0f0f0; /* Highlight effect on hover */
        }
        .bullet-checkbox {
            margin-right: 10px; /* Space between checkbox and text */
            cursor: pointer;
            transform: scale(1.2); /* Slightly larger checkbox */
        }
        .bullet-point-option span {
            color: #333;
            font-size: 14px;
        }
        .bullet-point-option input[type="checkbox"]:checked + span {
            font-weight: bold; /* Optional: Make checked items bold */
            color: #333;
        }
        .generate-btn-container {
            display: flex;
            justify-content: flex-end; /* Align button to the right */
            margin-top: 10px; /* Optional: space above the button */
        }
        .generate-btn {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            border: none;
            border-radius: 8px; /* Rounded corners */
            font-size: 16px;
            font-weight: bold;
            color: #ffffff;
            cursor: pointer;
            background: linear-gradient(45deg, #ff0077, #9b00e5); /* Gradient background */
            transition: transform 0.2s ease-in-out;
            outline: none;
        }
        .generate-btn i {
            margin-right: 8px; /* Space between icon and text */
            font-size: 18px;
        }
        .generate-btn:hover {
            transform: scale(1.05); /* Slight zoom effect on hover */
        }
        .generate-btn:active {
            transform: scale(0.98); /* Slight press effect on click */
        }
        .pdf-export .placeholder, 
        .pdf-export .gpt-generate-btn, 
        .pdf-export .remove-button, 
        .pdf-export .add-button {
            display: none !important; /* Hide placeholders and buttons */
        }
    </style>
    <style>
        .back-button {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            background-color: #2C2C2C;
            color: white;
            cursor: pointer;
            position: fixed;
            top: 10px;
            left: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s;
        }
        .back-button i {
            font-size: 20px;
        }
        .back-button:hover {
            background-color: #3B1F4C;
        }
        .button-container {
            margin-top: 20px; /* Adjust as needed */
        }
    </style>
    <style>
        .no-shadow-drag {
            box-shadow: none !important;
            opacity: 1 !important;
        }
        .custom-download-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px; /* Spacing between icon and text */
            background-color: #1E1E29; /* Background color similar to your layout */
            color: #FFFFFF; /* Text color */
            font-size: 16px;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .custom-download-btn i {
            font-size: 18px; /* Adjust icon size */
            color: #EADDFF; /* Icon color similar to the one in your image */
        }
        .custom-download-btn:hover {
            background-color: #3B1F4C; /* Background color on hover */
            color: #FFFFFF; /* Text color on hover */
        }
    </style>
    <style>
        .upload-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .upload-area {
            width: 180px; /* Width can be adjusted */
            aspect-ratio: 9 / 16;
            border: 2px dashed #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            background-color: #f9f9f9;
            border-radius: 8px;
        }

        .upload-area img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none; /* Hidden until an image is uploaded */
        }

        .upload-text {
            color: #888;
            font-size: 16px;
            text-align: center;
            position: absolute;
            z-index: 1;
        }
    </style>
    <style>
        .pdf-export .section-title {
            margin-bottom: 5mm; /* Add more spacing for section titles */
        }
        .pdf-export input {
            display: inline; /* Convert input fields to inline */
            font-size: 12px; /* Make it a bit smaller if needed */
        }

        .project {
            padding: 10px 15px; /* Padding inside the project section */
            border-radius: 5px; /* Rounded corners for the project box */
        }


        @media print {
            .add-button,
            .remove-button {
                display: none !important;
            }
        }

        .skills-content {
            display: flex;
            flex-direction: column;
        }

        .skill-row {
            display: flex;
            align-items: flex-start;
            margin-bottom: 5px;
        }

        .skills-category {
            flex: 0 0 30%; /* 30% width of the inner content area */
            max-width: calc(30% - 5px); /* Account for right margin */
            font-weight: bold;
            color: #043579;
            margin-right: 5px; /* Space between category and details */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .skills-details {
            flex: 0 0 70%; /* 70% width of the inner content area */
            max-width: 70%;
            color: #333;
            overflow-wrap: break-word;
            word-break: break-word;
            white-space: normal;
        }
    </style>
    <style>
        .date-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .date-display {
            cursor: pointer;
            color: black; /* Black text color */
            text-decoration: none; /* Remove underline */
            position: relative;
        }

        .month-picker {
            position: fixed;
            background: white;
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1010;
            width: 200px;
            text-align: center;
            cursor: default;
            border-radius: 8px; /* Slightly rounded corners for a modern look */
        }

        .month-picker .year {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .month-picker .months {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
        }

        .month-picker .month {
            width: 45px;
            padding: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.1s ease-in-out; /* Smooth transition */
            border-radius: 6px;
            background-color: white; /* Default background */
        }

        .month-picker .month:hover {
            background-color: #eaeefc; /* Soft pastel hover color */
            color: #4a6ef5; /* Contrast text color */
            transform: scale(1.1); /* Slight zoom effect */
        }

        .month-picker .actions {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
        }

        .month-picker .action {
            cursor: pointer;
            font-size: 14px;
            color: #4a6ef5; /* Soft blue for actions */
            transition: color 0.1s ease-in-out; /* Smooth color transition */
        }

        .month-picker .action:hover {
            color: #354bb7; /* Darker blue on hover */
        }

        .year span {
            cursor: pointer;
            transition: all 0.1s ease-in-out; /* Smooth transition for year navigation */
        }

        .year span:hover {
            color: #4a6ef5; /* Match hover color for consistency */
            transform: scale(1.2); /* Slight zoom effect */
        }
    </style>
    <style>
        #upgrade-alert {
            background-color: #ffe5e5;
            border: 1px solid #f5c2c2;
            color: #a94442;
            padding: 15px;
            margin: 20px auto;
            border-radius: 5px;
            text-align: center;
            width: 80%;
            max-width: 500px;
            position: relative;
        }

        #upgrade-alert button {
            background-color: #007bff;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        #upgrade-alert button:hover {
            background-color: #0056b3;
        }

        #upgrade-alert span {
            position: absolute;
            top: 10px;
            right: 15px;
            cursor: pointer;
            font-size: 20px;
        }
        .university-entry .remove-button {
            border: none;
            cursor: pointer;
            text-align: center;
            display: flex;
            position: absolute;
            color: rgb(255, 0, 0);
            background: 0;
            align-items: center;
            padding: 0;
            margin: 0;
        }
        .university-entry .remove-button, .university-entry .add-button {
            display: none; /* Hide the remove button by default */
        }
        .university-entry:hover .remove-button, .university-entry:hover .add-button {
            display: inline-flex; /* Display the remove button when hovering over .section-title p */
        }
    </style>
</head>
<body>
	<section style="width: 100%; position: block; top: 0; height: auto; background-color: #1E1E29; position: fixed; z-index: 30;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin: 0 5%;">
            <button class="back-button" onclick="goBackToDashboard()"><i class="bi bi-arrow-left"></i></button>
            <div class="button-container">
                <div id="save-status"></div>
                <p id="template-name" style="border: #AFAFAF 2px; border-radius: 4px; color: white !important; background-color: #333144; width: 500px !important; margin-top: 3px;" contenteditable="true" spellcheck="false" class="editable-text placeholder">Untitled</p>
            </div>
            <div style="display: flex; padding: 1%; justify-content: center; justify-self: center;">
                <div class="sets">
                    <button style="border-radius: 8px 0 0 8px;" data-tooltip="Bold" onclick="document.execCommand('bold', false, '')"><strong>B</strong></button>
                    <button data-tooltip="Italic" onclick="document.execCommand('italic', false, '')"><i class="fa-solid fa-italic"></i></button>
                    <button style="border-radius: 0 8px 8px 0;" data-tooltip="Underline" onclick="document.execCommand('underline', false, '')"><i class="fa-solid fa-underline"></i></button>
                </div>
    
                <div class="sets">
                    <button style="border-radius: 8px 0 0 8px;" data-tooltip="Justify Left" onclick="document.execCommand('justifyLeft', false, '')"><i class='fas fa-align-left'></i></i></button>
                    <button data-tooltip="Justify Center" onclick="document.execCommand('justifyCenter', false, '')"><i class='fas fa-align-center'></i></button>
                    <button style="border-radius: 0 8px 8px 0;" data-tooltip="Justify Right" onclick="document.execCommand('justifyRight', false, '')"><i class='fas fa-align-right'></i></button>
                </div>
    
                <div class="sets">
                    <button style="border-radius: 8px 0 0 8px;" onclick="changeFontSize(-1)"><i class='fas fa-minus'></i></button>
                    <button onclick="resetFontSize()"><i class="material-icons" style="font-size:18px">text_fields</i></button>
                    <button style="border-radius: 0 8px 8px 0;" onclick="changeFontSize(1)"><i class='fas fa-plus'></i></button>
                </div>
    
                <div class="sets">
                    <button style="border-radius: 8px 0 0 8px;" onclick="changeLineHeight(-0.1)"><i class='fas fa-minus'></i></button>
                    <button onclick="resetLineHeight()"><i class="material-icons" style="font-size:18px">format_line_spacing</i></button>
                    <button style="border-radius: 0 8px 8px 0;" onclick="changeLineHeight(0.1)"><i class='fas fa-plus'></i></button>
                </div>
            </div>
            <div>
                <button id="download-pdf" class="custom-download-btn">
                    <i class="fa fa-download"></i>Download
                </button>
            </div>
        </div>
        <div style="width: 100%; background-color: #272636; justify-content: center; display: flex;">
            <div id="ruler" style="width: 210mm; margin-right: 2mm; margin-left: 0;">
                <div class="measure-line" id="left-measure-line"></div>
                <div class="measure-line" id="right-measure-line"></div>
                <div class="draggable-marker" id="left-marker"></div>
                <div class="draggable-marker" id="right-marker"></div>
            </div>
        </div>
    </section>
    
    <div id="editable-content" class="draggable">
        <page size="A4" id="main-container" class="page">

        </page>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.0/jspdf.umd.min.js"></script>
    

    <script>
        function goBackToDashboard() {
            window.location.href = '/dashboard';
        }

        $(document).ready(function () {
            const urlParams = new URLSearchParams(window.location.search);
            const documentId = urlParams.get('id');

            if (documentId) {
                // Fetch the template name from the backend
                fetch(`http://localhost:3000/load/${documentId}`)
                    .then(response => response.json())
                    .then(data => {
                        // If there's a template name, display it
                        if (data.template_name) {
                            const fullName = data.template_name;
                            const truncatedName =
                                fullName.length > 10 ? fullName.slice(0, 10) + '...' : fullName;

                            // Set the truncated name with a tooltip showing the full name
                            $('#template-name')
                                .text(truncatedName)
                                .attr('title', fullName); // Add a tooltip with the full name
                        } else {
                            $('#template-name').text('Untitled').attr('title', 'Untitled'); // Fallback if no name found
                        }
                    })
                    .catch(error => console.error('Error fetching template:', error));
            }

            // Save the new template name to the server on input
            $('#template-name').on('input', function () {
                const newName = $(this).text();
                const documentId = new URLSearchParams(window.location.search).get('id');

                fetch(`/update-template-name/${documentId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ newName }),
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            $('#save-status').text('Saved').fadeIn().delay(1000).fadeOut();
                        } else {
                            $('#save-status').text('Error saving').fadeIn().delay(1000).fadeOut();
                        }
                    })
                    .catch(error => console.error('Error updating template name:', error));
            });

            // Highlight all text in the template name field when it gains focus
            $('#template-name').on('focus', function () {
                const range = document.createRange();
                const selection = window.getSelection();
                range.selectNodeContents(this);
                selection.removeAllRanges();
                selection.addRange(range);
            });
        });

    </script>
    <script>
        // Define the default template
        const defaultTemplate = `
            <div id="top-info" style="justify-content: center; display: flex; margin-bottom: 5mm;">
                <div>
                    <p class="editable-text placeholder" contenteditable="true" spellcheck="false" data-placeholder="NAME" style="font-weight: bold; font-size: 18px; margin-bottom: 2px; color: #043579; text-transform: uppercase; line-height: 1 !important;">NAME</p>
                    <div style="display: flex; min-width: 100%;">
                        <table>
                            <tr>
                                <th>Address</th>
                                <td style="min-width: 10cm; vertical-align: middle; display: flex; align-items: center; height:16px;"><strong>:</strong> <p class="editable-text placeholder" style="line-height: 1 !important;" contenteditable="true" spellcheck="false" data-placeholder="Kuala Lumpur, Malaysia">Kuala Lumpur, Malaysia</p></td>
                            </tr>
                            <tr>
                                <th>Mobile</th>
                                <td style="vertical-align: middle; display: flex; align-items: center; height:16px;"><strong>:</strong> <p class="editable-text placeholder" style="line-height: 1 !important;" contenteditable="true" spellcheck="false" data-placeholder="012-3456789">012-3456789</p></td>
                            </tr>
                            <tr>
                                <th>Email</th>
                                <td style="vertical-align: middle; display: flex; align-items: center; height:16px;"><strong>:</strong> <p class="editable-text placeholder" style="line-height: 1 !important;" contenteditable="true" spellcheck="false" data-placeholder="abc123@gmail.com">abc123@gmail.com</p></td>
                            </tr>
                            <tr>
                                <th>LinkedIn</th>
                                <td style="vertical-align: middle; display: flex; align-items: center; height:16px;"><strong>:</strong> <p class="editable-text placeholder" style="line-height: 1 !important;" contenteditable="true" spellcheck="false" data-placeholder="https://www.linkedin.com/in/user123">https://www.linkedin.com/in/user123</p></td>
                            </tr>
                        </table>                       
                    </div>
                </div>
            </div>
            
            <div id="objective" class="draggable-section section">
                <div class="section-title" style="display: flex;">
                    <p>OBJECTIVE</p>
                    <button class="remove-button" data-tooltip="Remove section" onclick="removeObjectiveSection(this)"><i class="bi bi-x-circle"></i></button>
                </div>
                <p id="editable-text" class="editable-text placeholder" contenteditable="true" spellcheck="false" data-placeholder="Experienced Regional Office Manager with over 13 years of expertise in driving operational efficiency, client satisfaction, and strategic improvements across cross-functional teams, achieving measurable results in cost reduction, brand growth, , and personnel management.">
                    Experienced Regional Office Manager with over 13 years of expertise in driving operational efficiency, client satisfaction, and strategic improvements across cross-functional teams, achieving measurable results in cost reduction, brand growth, , and personnel management.
                </p>
            </div>

            <div id="work-experience" class="draggable-section section">
                <div class="section-title" style="display: flex;">
                    <p>WORK&nbsp;EXPERIENCE</p>
                    <button class="add-button" data-tooltip="Add work-experience" onclick="addWorkExperience()"><i class="bi bi-plus-circle"></i></button>
                    <button class="remove-button" data-tooltip="Remove section" onclick="removeWorkExperienceSection(this)"><i class="bi bi-x-circle"></i></button>
                </div>
                <div id="work1">
                    <div style="display: flex; max-width: 100%; justify-content: space-between;">
                        <div style="max-width: 70%; min-width: 70%;">
                            <p id="editable-text" class="editable-text placeholder" contenteditable="true" spellcheck="false" data-placeholder="Company" style="font-weight: bold;">Company</p>
                        </div>
                        <div class="date-container">
                            <strong>(</strong>
                            <div>
                                <span id="start-date-display-11" class="date-display" onclick="openMonthPicker('start', 11)">Start Date</span>
                                <div id="start-month-picker-11" class="month-picker" style="display: none;"></div>
                            </div>
                            <strong>-</strong>
                            <div>
                                <span id="end-date-display-11" class="date-display" onclick="openMonthPicker('end', 11)">Present</span>
                                <div id="end-month-picker-11" class="month-picker" style="display: none;"></div>
                            </div>
                            <strong>)</strong>
                        </div>
                    </div>
                    <p id="editable-text" class="editable-text placeholder" contenteditable="true" spellcheck="false" data-placeholder="Job title">Job title</p>
                    <ul class="ul" style="padding-left: 20px;">
                        <li>
                            <p id="bullet-points-1-1" class="bullet-points placeholder" contenteditable="true" spellcheck="false" data-placeholder="Bullet point 1">Bullet point 1</p>
                        </li>
                        <li>
                            <p id="bullet-points-1-2" class="bullet-points placeholder" contenteditable="true" spellcheck="false" data-placeholder="Bullet point 2">Bullet point 2</p>
                        </li>
                        <li>
                            <p id="bullet-points-1-3" class="bullet-points placeholder" contenteditable="true" spellcheck="false" data-placeholder="Bullet point 3">Bullet point 3</p>
                        </li>
                        <button type="button" class="gpt-generate-btn" onclick="showGptGenerateForm(1)">AI Generate✨</button>
                    </ul>
                    <div class="gpt-generate-form" id="gpt-generate-form-1" style="display:none;">
                        <div style="padding: 20px;">
                            <div class="form-header">
                                <button class="close-btn" onclick="closeGptForm(1)">✕</button>
                                <h1 style="font-size:30px; margin: 0;">Create work experience</h1>
                            </div>
                            <div class="form-group">
                                <label for="role">What was your role?</label>
                                <input type="text" class="role form-field" placeholder="e.g., Software Engineer">
                            </div>
                    
                            <div class="form-group">
                                <label for="experience-summary">Your work experience in one sentence:</label>
                                <textarea class="experience-summary form-field" rows="2" placeholder="e.g., Led the development of a project to reduce manual tasks..."></textarea>
                            </div>
                    
                            <div class="generate-btn-container">
                                <button type="button" class="generate-btn" onclick="generateExperience(1)"><i class="fa-solid fa-bolt"></i> Generate</button>
                            </div>
                        </div>
                
                        <div class="gpt-suggestions">
                            <div class="suggestion-options">
                                <p id="placeholder-message" style="color: #888;">Please enter your role and work experience above</p>
                                <!-- Generated suggestions with checkboxes will appear here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- New Project Section with Padding -->
                <div class="project">
                    <strong style="font-size: 12px;">Project : </strong> <span class="editable-text placeholder" contenteditable="true" spellcheck="false" data-placeholder="Project Name">Project Name</span>
                    <ul style="padding-left: 20px; padding-top: 5px;">
                        <li><p class="bullet-points placeholder" contenteditable="true" spellcheck="false" data-placeholder="Project bullet point 1">Project bullet point 1</p></li>
                        <li><p class="bullet-points placeholder" contenteditable="true" spellcheck="false" data-placeholder="Project bullet point 2">Project bullet point 2</p></li>
                        <li><p class="bullet-points placeholder" contenteditable="true" spellcheck="false" data-placeholder="Project bullet point 3">Project bullet point 3</p></li>
                    </ul>
                </div>
            </div>

            <div id="education" class="draggable-section section">
                <div class="section-title" style="display: flex;">
                    <p>EDUCATIONAL&nbsp;BACKGROUND</p>
                    <button class="add-button" data-tooltip="Add university" onclick="addUniversity()"><i class="bi bi-plus-circle"></i></button>
                    <button class="remove-button" data-tooltip="Remove section" onclick="removeUniversitySection(this)"><i class="bi bi-x-circle"></i></button>
                </div>
                <div style="display: flex; max-width: 100%; justify-content: space-between;">
                    <div style="max-width: 70%; min-width: 70%;">
                        <p id="editable-text" class="editable-text placeholder" contenteditable="true" spellcheck="false" data-placeholder="University" style="font-weight: bold;">University</p>
                    </div>
                    <div class="date-container">
                        <strong>(</strong>
                        <div>
                            <span id="start-date-display-21" class="date-display" onclick="openMonthPicker('start', 21)">Start Date</span>
                            <div id="start-month-picker-21" class="month-picker" style="display: none;"></div>
                        </div>
                        <strong>-</strong>
                        <div>
                            <span id="end-date-display-21" class="date-display" onclick="openMonthPicker('end', 21)">Present</span>
                            <div id="end-month-picker-21" class="month-picker" style="display: none;"></div>
                        </div>
                        <strong>)</strong>
                    </div>
                </div>
                <p id="editable-text" class="editable-text placeholder" contenteditable="true" spellcheck="false" data-placeholder="Degree">Degree</p>
            </div>

            <div id="skills" class="draggable-section section">
                <div class="section-title" style="display: flex;">
                    <p>SKILLS</p>
                    <button class="add-button" data-tooltip="Add skill" onclick="addSkillRow()"><i class="bi bi-plus-circle"></i></button>
                    <button class="remove-button" data-tooltip="Remove section" onclick="removeUniversitySection(this)"><i class="bi bi-x-circle"></i></button>
                </div>
                <div class="skills-content">
                    <div class="skill-row">
                        <p class="editable-text placeholder skills-category" contenteditable="true" spellcheck="false" data-placeholder="Operations & Office Management">Operations & Office Management</p>
                        <p class="editable-text placeholder skills-details" contenteditable="true" spellcheck="false" data-placeholder="Operations Management, Office Administration, Strategic Planning...">Operations Management, Office Administration, Strategic Planning...</p>
                    </div>
                    <div class="skill-row">
                        <p class="editable-text placeholder skills-category" contenteditable="true" spellcheck="false" data-placeholder="Team & Personnel Management">Team & Personnel Management</p>
                        <p class="editable-text placeholder skills-details" contenteditable="true" spellcheck="false" data-placeholder="Performance Review, Training & Development, etc.">Performance Review, Training & Development, etc.</p>
                    </div>
                    <div class="skill-row">
                        <p class="editable-text placeholder skills-category" contenteditable="true" spellcheck="false" data-placeholder="Client & Service Management">Client & Service Management</p>
                        <p class="editable-text placeholder skills-details" contenteditable="true" spellcheck="false" data-placeholder="Client Relationship Management, etc.">Client Relationship Management, etc.</p>
                    </div>
                    <div class="skill-row">
                        <p class="editable-text placeholder skills-category" contenteditable="true" spellcheck="false" data-placeholder="Financial & Data Analysis">Financial & Data Analysis</p>
                        <p class="editable-text placeholder skills-details" contenteditable="true" spellcheck="false" data-placeholder="Financial Reporting, Data Analysis, etc.">Financial Reporting, Data Analysis, etc.</p>
                    </div>
                    <div class="skill-row">
                        <p class="editable-text placeholder skills-category" contenteditable="true" spellcheck="false" data-placeholder="Software">Software</p>
                        <p class="editable-text placeholder skills-details" contenteditable="true" spellcheck="false" data-placeholder="Microsoft Office Suite, QuickBooks, etc.">Microsoft Office Suite, QuickBooks, etc.</p>
                    </div>
                    <div class="skill-row">
                        <p class="editable-text placeholder skills-category" contenteditable="true" spellcheck="false" data-placeholder="Languages">Languages</p>
                        <p class="editable-text placeholder skills-details" contenteditable="true" spellcheck="false" data-placeholder="English (Fluent), Spanish (Intermediate), etc.">English (Fluent), Spanish (Intermediate), etc.</p>
                    </div>
                </div>
            </div>
        `;

        // Load content or default template on page load
        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const documentId = urlParams.get('id');
            
            if (documentId) {
                fetch(`http://localhost:3000/load/${documentId}`)
                    .then(response => response.json())
                    .then(data => {
                        const content = data.content;
                        const mainContainer = document.getElementById('main-container');
                        if (!content || content.trim() === '') {
                            mainContainer.innerHTML = defaultTemplate;
                        } else {
                            mainContainer.innerHTML = content;
                        }
                        attachEditableEvents(); // Attach events to the loaded content
                    })
                    .catch((error) => console.error('Error:', error));
            }
        });

        // Function to attach events to editable elements
        function attachEditableEvents() {
            const editableElements = document.querySelectorAll('.editable-text, .bullet-points');

            // Handle contenteditable fields
            editableElements.forEach((el) => {
                el.addEventListener('focus', function () {
                    if (el.innerText === el.dataset.placeholder) {
                        el.innerText = '';
                        el.classList.remove('placeholder');
                    }
                });

                el.addEventListener('blur', function () {
                    if (el.innerText.trim() === '') {
                        el.innerText = el.dataset.placeholder;
                        el.classList.add('placeholder');
                    }
                });

                el.addEventListener('input', function () {
                    el.classList.toggle('placeholder', el.innerText.trim() === '');
                    triggerAutoSave();
                });
            });
        }

        // Save the entire <page> content
        function savePageContent() {
            const content = document.querySelector('#main-container').innerHTML;
            const documentId = new URLSearchParams(window.location.search).get('id');

            fetch(`/save/${documentId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ content }),
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Content saved successfully!');

                        // Trigger the screenshot update
                        fetch(`/save-screenshot/${documentId}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ content }),
                        })
                            .then(response => response.json())
                            .then(screenshotData => {
                                if (screenshotData.success) {
                                    console.log('Screenshot updated successfully!');
                                } else {
                                    console.error('Screenshot update failed:', screenshotData.error);
                                }
                            })
                            .catch(error => console.error('Screenshot error:', error));
                    } else {
                        console.error('Save error:', data.error);
                    }
                })
                .catch(error => console.error('Save content error:', error));
        }

        // Auto-save functionality (debounced to save after 1 second of inactivity)
        let saveTimeout;

        function triggerAutoSave() {
            clearTimeout(saveTimeout); // Clear the previous timeout
            saveTimeout = setTimeout(savePageContent, 1000); // Save the entire <page> after 1 second of inactivity
        }

        // Call attachEditableEvents on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', attachEditableEvents);

        function handlePlaceholder(el) {
            el.addEventListener('focus', function () {
                if (el.innerText === el.dataset.placeholder) {
                    el.innerText = '';
                    el.classList.remove('placeholder');
                }
            });

            el.addEventListener('blur', function () {
                if (el.innerText.trim() === '') {
                    el.innerText = el.dataset.placeholder;
                    el.classList.add('placeholder');
                }
            });
        }

        editableElements.forEach(el => {
            handlePlaceholder(el);
            el.addEventListener('input', function () {
                el.classList.toggle('placeholder', el.innerText.trim() === '');
                triggerAutoSave();
            });
        });
    </script>
    <!-- ruler -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const container = document.getElementById('main-container');
            Sortable.create(container, {
                handle: '.draggable-section', // Only drag using the handle
                animation: 150, // Animation duration in milliseconds
                ghostClass: 'sortable-ghost', // Class name for the ghost element
            });
        });
        
        function addTick(position, size, symbol, number = null) {
            // Create a tick element
            const tick = document.createElement('div');
            tick.className = 'tick';
            tick.style.left = `${position}mm`;
            
            if (size === 'large') {
                tick.classList.add('large-tick');
            }
            
            // Set the tick symbol or number
            if (number !== null) {
                tick.textContent = number; // Display the number
            } else {
                tick.textContent = symbol; // Display the symbol
            }
            
            // Append to ruler
            document.getElementById('ruler').appendChild(tick);
        }

        // Loop to add ticks
        let numberLabel = 1; // Initialize the number counter
        for (let i = 0; i <= 210; i += 5) {
            if (i >= 10 && i <= 200 && i % 20 === 0) {
                addTick(i, 'large', '|', numberLabel); // Add a number every 20mm starting from 10mm
                numberLabel++; // Increment the number label
            } else if (i % 10 === 0) {
                addTick(i, 'large', '|'); // Large tick for every 10mm
            } else {
                addTick(i, 'small', '╵'); // Small tick for every 5mm
            }
        }

        let currentMarker = null;
        const minPadding = 10; // Minimum padding in mm
        const maxPadding = 30; // 40mm max padding on either side
        const mmToPxRatio = document.getElementById('ruler').offsetWidth / 210; // Convert mm to px

        document.getElementById('left-marker').addEventListener('mousedown', function () {
            currentMarker = 'left';
            document.getElementById('left-measure-line').style.display = 'block'; // Show the left line
        });

        document.getElementById('right-marker').addEventListener('mousedown', function () {
            currentMarker = 'right';
            document.getElementById('right-measure-line').style.display = 'block'; // Show the right line
        });

        document.addEventListener('mouseup', function () {
            if (currentMarker) {
                const leftLine = document.getElementById('left-measure-line');
                const rightLine = document.getElementById('right-measure-line');

                const pageElement = document.querySelector('page');

                // Apply padding changes when mouse is released
                if (currentMarker === 'left') {
                    let newLeftPadding = Math.min(Math.max(parseInt(leftLine.style.left) / mmToPxRatio, minPadding), maxPadding);
                    pageElement.style.paddingLeft = `${newLeftPadding}mm`;
                } else if (currentMarker === 'right') {
                    let newRightPadding = Math.min(Math.max((document.getElementById('ruler').offsetWidth - parseInt(rightLine.style.left)) / mmToPxRatio, minPadding), maxPadding);
                    pageElement.style.paddingRight = `${newRightPadding}mm`;
                }

                // Hide the lines
                leftLine.style.display = 'none';
                rightLine.style.display = 'none';
                currentMarker = null;
            }
        });

        document.addEventListener('mousemove', function (e) {
            if (currentMarker) {
                const rulerRect = document.getElementById('ruler').getBoundingClientRect();
                const mmToPxRatio = rulerRect.width / 210; // Convert mm to px

                if (currentMarker === 'left') {
                    let newLeft = e.clientX - rulerRect.left;
                    newLeft = Math.min(Math.max(newLeft, minPadding * mmToPxRatio), maxPadding * mmToPxRatio);
                    document.getElementById('left-measure-line').style.left = newLeft + 'px';
                    document.getElementById('left-marker').style.left = newLeft + 'px';
                } else if (currentMarker === 'right') {
                    let newRight = e.clientX - rulerRect.left;
                    newRight = Math.min(Math.max(newRight, (210 - maxPadding) * mmToPxRatio), rulerRect.width - minPadding * mmToPxRatio);
                    document.getElementById('right-measure-line').style.left = newRight + 'px';
                    document.getElementById('right-marker').style.left = newRight + 'px';
                }
            }
        });


        function initFontSizes() {
            const mainContainer = document.getElementById('main-container');
            const paragraphs = mainContainer.querySelectorAll('.section p');

            paragraphs.forEach((p) => {
                // Store the initial font size in a data attribute
                const computedFontSize = window.getComputedStyle(p).fontSize;
                p.setAttribute('data-initial-font-size', computedFontSize);
            });
        }

        function changeFontSize(delta) {
            const mainContainer = document.getElementById('main-container');
            const paragraphs = mainContainer.querySelectorAll('.section p');

            paragraphs.forEach((p) => {
                let currentFontSize = parseInt(window.getComputedStyle(p).fontSize);
                currentFontSize += delta;
                p.style.fontSize = `${currentFontSize}px`;
            });
        }

        function resetFontSize() {
            const mainContainer = document.getElementById('main-container');
            const paragraphs = mainContainer.querySelectorAll('.section p');

            paragraphs.forEach((p) => {
                const initialFontSize = p.getAttribute('data-initial-font-size');
                p.style.fontSize = initialFontSize; // Reset to the initial font size
            });
        }

        // Call this function to initialize font sizes when the document is ready
        document.addEventListener('DOMContentLoaded', initFontSizes);



        let currentLineHeight = 1.5;

        function changeLineHeight(amount) {
            currentLineHeight += amount;

            // Apply the new line height to all paragraphs within the main container
            const mainContainer = document.getElementById('main-container');
            const paragraphs = mainContainer.querySelectorAll('.section p');

            paragraphs.forEach((p) => {
                p.style.lineHeight = currentLineHeight.toString();
            });
        }

        function resetLineHeight() {
            currentLineHeight = 1.5; // Default line height
            const mainContainer = document.getElementById('main-container');
            const paragraphs = mainContainer.querySelectorAll('.section p');

            paragraphs.forEach((p) => {
                p.style.lineHeight = currentLineHeight.toString();
            });
        }
    </script>
    <!-- gpt generate & month picker -->
    <script>
        function showGptGenerateForm(id) {
            const form = document.getElementById(`gpt-generate-form-${id}`);
            form.style.display = 'block';
        }

        function closeGptForm(id) {
            const form = document.getElementById(`gpt-generate-form-${id}`);
            form.style.display = 'none';
            savePageContent();
        }


        async function generateExperience(id) {
            const form = document.getElementById(`gpt-generate-form-${id}`);
            const role = form.querySelector('.role').value.trim();
            const experienceSummary = form.querySelector('.experience-summary').value.trim();

            if (!role || !experienceSummary) {
                alert('Please fill out your role and experience summary.');
                return;
            }

            const placeholderMessage = form.querySelector('#placeholder-message');
            placeholderMessage.textContent = 'Generating suggestions... Please wait.';

            try {
                const response = await fetch('/generate-gpt-suggestions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: `Generate three bullet points for the role "${role}" based on the following summary: "${experienceSummary}". Each bullet point should be unique and highlight different aspects of the role.`,
                    }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    alert(errorData.error || 'An error occurred.');
                    placeholderMessage.textContent = 'Error generating suggestions.';
                    return;
                }

                const data = await response.json();
                if (data && Array.isArray(data)) {
                    // Clear previous suggestions
                    const suggestionsContainer = form.querySelector('.suggestion-options');
                    suggestionsContainer.innerHTML = '';

                    data.forEach((choice, index) => {
                        const suggestionDiv = document.createElement('label');
                        suggestionDiv.classList.add('bullet-point-option');

                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.classList.add('bullet-checkbox');
                        checkbox.dataset.content = choice.message.content.trim();
                        checkbox.dataset.index = index;
                        checkbox.dataset.id = id;

                        const labelText = document.createElement('span');
                        labelText.textContent = choice.message.content.trim();

                        suggestionDiv.appendChild(checkbox);
                        suggestionDiv.appendChild(labelText);
                        suggestionsContainer.appendChild(suggestionDiv);

                        checkbox.addEventListener('change', function () {
                            if (checkbox.checked) {
                                checkbox.dataset.timestamp = Date.now(); // Set timestamp when checked
                            } else {
                                delete checkbox.dataset.timestamp; // Remove timestamp if unchecked
                            }
                            updateBulletPoints(id);
                        });
                    });
                } else {
                    placeholderMessage.textContent = "No suggestions found. Please try again.";
                }

            } catch (error) {
                console.error('Error generating experience descriptions:', error);
                placeholderMessage.textContent = 'Error occurred while generating suggestions.';
            }
        }

        // Update bullet points to maintain order based on the time they were checked
        function updateBulletPoints(id) {
            const allCheckboxes = document.querySelectorAll(`#gpt-generate-form-${id} .bullet-checkbox`);
            const checkedChoices = Array.from(allCheckboxes).filter(cb => cb.checked);

            // Sort checked choices by timestamp
            checkedChoices.sort((a, b) => a.dataset.timestamp - b.dataset.timestamp);

             // Clear and reorder bullet points based on sorted checked choices
            for (let i = 0; i < 3; i++) {
                const bulletPoint = document.getElementById(`bullet-points-${id}-${i + 1}`);
                if (checkedChoices[i]) {
                    bulletPoint.textContent = checkedChoices[i].dataset.content;
                    bulletPoint.classList.remove('placeholder');
                } else {
                    bulletPoint.textContent = `Bullet point ${i + 1}`;
                    bulletPoint.classList.add('placeholder');
                }
            }

            savePageContent(); // Update the entire HTML content in the database
        }

        let currentYear = new Date().getFullYear();

        function openMonthPicker(type, counter) {
            const monthPicker = document.getElementById(
                type === 'start' ? `start-month-picker-${counter}` : `end-month-picker-${counter}`
            );
            const otherPicker = document.getElementById(
                type === 'start' ? `end-month-picker-${counter}` : `start-month-picker-${counter}`
            );

            otherPicker.style.display = 'none'; // Close the other picker if open

            if (monthPicker.innerHTML.trim() === '') {
                generateMonthPicker(monthPicker, type, counter);
            }
            monthPicker.style.display = 'block';
        }

        function generateMonthPicker(container, type, counter) {
            container.innerHTML = `
                <div class="year">
                    <span onclick="changeYear(-1, '${type}', ${counter})"><</span>
                    <span id="${type}-year-display-${counter}">${currentYear}</span>
                    <span onclick="changeYear(1, '${type}', ${counter})">></span>
                </div>
                <div class="months">
                    ${['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
                        .map((month, index) =>
                            `<div class="month" onclick="selectMonth(${index}, '${type}', ${counter})">${month}</div>`
                        )
                        .join('')}
                </div>
                <div class="actions">
                    <span class="action" onclick="clearDate('${type}', ${counter})">Clear</span>
                    <span class="action" onclick="selectThisMonth('${type}', ${counter})">This Month</span>
                </div>
            `;
        }

        function changeYear(offset, type, counter) {
            const yearDisplay = document.getElementById(`${type}-year-display-${counter}`);
            currentYear = parseInt(yearDisplay.textContent) + offset;
            yearDisplay.textContent = currentYear;
        }

        function selectMonth(monthIndex, type, counter) {
            const displayElement = type === 'start'
                ? document.getElementById(`start-date-display-${counter}`)
                : document.getElementById(`end-date-display-${counter}`);

            const monthName = new Date(currentYear, monthIndex).toLocaleString('default', { month: 'short' });
            displayElement.textContent = `${monthName}, ${currentYear}`;

            closeMonthPicker(type, counter);

            if (type === 'end' && displayElement.textContent === 'Present') {
                displayElement.textContent = 'Present';
            }

            savePageContent();
        }

        function clearDate(type, counter) {
            const displayElement = type === 'start'
                ? document.getElementById(`start-date-display-${counter}`)
                : document.getElementById(`end-date-display-${counter}`);

            if (type === 'end') {
                displayElement.textContent = 'Present';
            } else {
                displayElement.textContent = 'Select Start Date';
            }

            closeMonthPicker(type, counter);
            savePageContent();
        }

        function selectThisMonth(type, counter) {
            const monthIndex = new Date().getMonth();
            const year = new Date().getFullYear();

            const monthName = new Date(year, monthIndex).toLocaleString('default', { month: 'short' });

            const displayElement = type === 'start'
                ? document.getElementById(`start-date-display-${counter}`)
                : document.getElementById(`end-date-display-${counter}`);

            displayElement.textContent = `${monthName}, ${year}`;
            closeMonthPicker(type, counter);
            savePageContent();
        }

        function closeMonthPicker(type, counter) {
            const monthPicker = document.getElementById(
                type === 'start' ? `start-month-picker-${counter}` : `end-month-picker-${counter}`
            );
            monthPicker.style.display = 'none';
        }

        // Close all month pickers when clicking outside
        document.addEventListener('click', (event) => {
            if (!event.target.closest('.month-picker') && !event.target.closest('.date-display')) {
                document.querySelectorAll('.month-picker').forEach(picker => picker.style.display = 'none');
            }
        });

    </script>
    <!-- save as jspdf -->
    <script>
        function saveAsPDF() {
            const pageElement = document.getElementById('main-container');
            
            // Temporarily add the 'pdf-export' class to apply PDF-only styles
            pageElement.classList.add('pdf-export');
            
            // Use jsPDF's html method to convert HTML to PDF
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });

            // Generate the PDF and save
            pdf.html(pageElement, {
                callback: function (pdf) {
                    pdf.save('template.pdf');
                    pageElement.classList.remove('pdf-export'); // Remove the class after generating the PDF
                },
                x: 0,
                y: 0,
                width: 210,
                windowWidth: 800,
            });
        }

        // Attach the saveAsPDF function to a button click event
        document.getElementById('download-pdf').addEventListener('click', saveAsPDF);
    </script>
    <!-- add + remove -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const container = document.getElementById('main-container');
            Sortable.create(container, {
                handle: '.section-title', // Drag handle
                animation: 150, // Animation duration
                dragClass: 'no-shadow-drag', // Apply no-shadow class while dragging
            });
        });

        function addSkillRow() {
            const skillsContainer = document.querySelector(".skills-content");
            const skillRow = document.createElement("div");
            skillRow.classList.add("skill-row");
            skillRow.innerHTML = `
                <p class="editable-text placeholder skills-category" contenteditable="true" spellcheck="false" data-placeholder="Skill Category">Skill Category</p>
                <p class="editable-text placeholder skills-details" contenteditable="true" spellcheck="false" data-placeholder="Skill Details">Skill Details</p>
                <button class="remove-button" data-tooltip="Remove" onclick="removeSkillRow(this)"><i class="bi bi-x-circle"></i></button>
            `;
            skillsContainer.appendChild(skillRow);
            savePageContent();
        }

        function removeSkillRow(button) {
            button.closest(".skill-row").remove();
            savePageContent();
        }

        function removeWorkExperienceSection(button) {
            // Find the closest parent with id 'work-experience' and remove it
            const workExperienceSection = button.closest('#work-experience');
            if (workExperienceSection) {
                workExperienceSection.remove();
            }
            savePageContent();
        }

        function removeObjectiveSection(button) {
            // Find the closest parent with id 'work-experience' and remove it
            const ObjectiveSection = button.closest('#objective');
            if (ObjectiveSection) {
                ObjectiveSection.remove();
            }
            savePageContent();
        }

        function removeUniversitySection(button) {
            // Find the closest parent with id 'work-experience' and remove it
            const UniversitySection = button.closest('#education');
            if (UniversitySection) {
                UniversitySection.remove();
            }
            savePageContent();
        }

        function removeSkillSection(button) {
            // Find the closest parent with id 'work-experience' and remove it
            const SkillSection = button.closest('#skills');
            if (SkillSection) {
                SkillSection.remove();
            }
            savePageContent();
        }

        let workExperienceCounter = 1; // Start indexing from 0

        function addWorkExperience() {
            // Dynamically calculate the next available ID
            const workExperienceContainer = document.getElementById('work-experience');
            const workExperienceEntries = workExperienceContainer.querySelectorAll('[id^="work"]'); // Select all elements with id starting with "work"
            const newSection = document.createElement('div');

            let maxId = 0;
            workExperienceEntries.forEach(entry => {
                const idNumber = parseInt(entry.id.replace('work', ''), 10); // Extract the number from the ID
                if (!isNaN(idNumber) && idNumber > maxId) {
                    maxId = idNumber;
                }
            });

            // Set the counter to the next available ID
            workExperienceCounter = maxId + 1;

            const newWorkExperience = document.createElement('div');
            newWorkExperience.className = 'work-experience-entry';
            newWorkExperience.innerHTML = `
                <div id="work${workExperienceCounter}">
                    <div style="display: flex; max-width: 100%; justify-content: space-between;">
                        <div style="max-width: 70%; min-width: 70%;">
                            <p id="editable-text" class="editable-text placeholder" contenteditable="true" spellcheck="false" data-placeholder="Company" style="font-weight: bold;">Company</p>
                        </div>
                        <div class="date-container">
                            <strong>(</strong>
                            <div>
                                <span id="start-date-display-1${workExperienceCounter}" class="date-display" onclick="openMonthPicker('start', 1${workExperienceCounter})">Start Date</span>
                                <div id="start-month-picker-1${workExperienceCounter}" class="month-picker" style="display: none;"></div>
                            </div>
                            <strong>-</strong>
                            <div>
                                <span id="end-date-display-1${workExperienceCounter}" class="date-display" onclick="openMonthPicker('end', 1${workExperienceCounter})">Present</span>
                                <div id="end-month-picker-1${workExperienceCounter}" class="month-picker" style="display: none;"></div>
                            </div>
                            <strong>)</strong>
                        </div>
                    </div>
                    <p id="editable-text" class="editable-text placeholder" contenteditable="true" spellcheck="false" data-placeholder="Job title">Job title</p>
                    <ul class="ul" style="padding-left: 20px;">
                        <li>
                            <p id="bullet-points-${workExperienceCounter}-1" class="bullet-points placeholder" contenteditable="true" spellcheck="false" data-placeholder="Bullet point 1">Bullet point 1</p>
                        </li>
                        <li>
                            <p id="bullet-points-${workExperienceCounter}-2" class="bullet-points placeholder" contenteditable="true" spellcheck="false" data-placeholder="Bullet point 2">Bullet point 2</p>
                        </li>
                        <li>
                            <p id="bullet-points-${workExperienceCounter}-3" class="bullet-points placeholder" contenteditable="true" spellcheck="false" data-placeholder="Bullet point 3">Bullet point 3</p>
                        </li>
                        <button type="button" class="gpt-generate-btn" onclick="showGptGenerateForm(${workExperienceCounter})">AI Generate✨</button>
                    </ul>
                    <div class="gpt-generate-form" id="gpt-generate-form-${workExperienceCounter}" style="display:none;">
                        <div style="padding: 20px;">
                            <div class="form-header">
                                <button class="close-btn" onclick="closeGptForm(${workExperienceCounter})">✕</button>
                                <h1 style="font-size:30px; margin: 0;">Create work experience</h1>
                            </div>
                            <div class="form-group">
                                <label for="role">What was your role?</label>
                                <input type="text" class="role form-field" placeholder="e.g., Software Engineer">
                            </div>
                    
                            <div class="form-group">
                                <label for="experience-summary">Your work experience in one sentence:</label>
                                <textarea class="experience-summary form-field" rows="2" placeholder="e.g., Led the development of a project to reduce manual tasks..."></textarea>
                            </div>
                    
                            <div class="generate-btn-container">
                                <button type="button" class="generate-btn" onclick="generateExperience(${workExperienceCounter})"><i class="fa-solid fa-bolt"></i> Generate</button>
                            </div>
                        </div>
                
                        <div class="gpt-suggestions">
                            <div class="suggestion-options">
                                <p id="placeholder-message" style="color: #888;">Please enter your role and work experience above</p>
                                <!-- Generated suggestions with checkboxes will appear here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- New Project Section with Padding -->
                <div class="project">
                    <strong>Project : </strong> <span class="editable-text placeholder" contenteditable="true" spellcheck="false" data-placeholder="Project Name">Project Name</span>
                    <ul style="padding-left: 20px; padding-top: 5px;">
                        <li><p class="bullet-points placeholder" contenteditable="true" spellcheck="false" data-placeholder="Project bullet point 1">Project bullet point 1</p></li>
                        <li><p class="bullet-points placeholder" contenteditable="true" spellcheck="false" data-placeholder="Project bullet point 2">Project bullet point 2</p></li>
                        <li><p class="bullet-points placeholder" contenteditable="true" spellcheck="false" data-placeholder="Project bullet point 3">Project bullet point 3</p></li>
                    </ul>
                </div>
            `;
            workExperienceContainer.appendChild(newWorkExperience);

            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent();
            adjustPageHeight();
        }

        let universityCounter = 1; // Counter for dynamically created university sections

        function addUniversity() {
            const educationContainer = document.getElementById('education');
            const educationEntries = educationContainer.querySelectorAll('[id^="university"]'); // Select all elements with id starting with "university"
            const newSection = document.createElement('div');

            // Dynamically calculate the next available ID
            let maxId = 0;
            educationEntries.forEach(entry => {
                const idNumber = parseInt(entry.id.replace('university', ''), 10); // Extract the number from the ID
                if (!isNaN(idNumber) && idNumber > maxId) {
                    maxId = idNumber;
                }
            });

            // Set the counter to the next available ID
            universityCounter = maxId + 1;

            newSection.id = `university${universityCounter}`;
            newSection.className = 'university-entry';
            newSection.style.maxWidth = '100%';
            newSection.style.justifyContent = 'space-between';
            newSection.innerHTML = `
                <div style="display: flex; max-width: 100%; justify-content: space-between; margin-top:3px;">
                    <div style="max-width: 70%; min-width: 70%;">
                        <p id="editable-text" class="editable-text placeholder" contenteditable="true" spellcheck="false" data-placeholder="University" style="font-weight: bold;">University</p>
                    </div>
                    <button class="remove-button" data-tooltip="Remove University" onclick="removeUniversity(${universityCounter})"><i class="bi bi-x-circle"></i></button>
                    <div class="date-container">
                        <strong>(</strong>
                        <div>
                            <span id="start-date-display-2${universityCounter}" class="date-display" onclick="openMonthPicker('start', 2${universityCounter})">Start Date</span>
                            <div id="start-month-picker-2${universityCounter}" class="month-picker" style="display: none;"></div>
                        </div>
                        <strong>-</strong>
                        <div>
                            <span id="end-date-display-2${universityCounter}" class="date-display" onclick="openMonthPicker('end', 2${universityCounter})">Present</span>
                            <div id="end-month-picker-2${universityCounter}" class="month-picker" style="display: none;"></div>
                        </div>
                        <strong>)</strong>
                    </div>
                </div>
                <p id="editable-text" class="editable-text placeholder" contenteditable="true" spellcheck="false" data-placeholder="Degree">Degree</p>
            `;

            educationContainer.appendChild(newSection);

            attachEditableEvents(); // Reattach listeners to new elements
            savePageContent(); // Save changes to the page
            adjustPageHeight();
        }

        function removeUniversity(id) {
            const university = document.getElementById(`university${id}`);
            if (university) {
                university.remove();
                savePageContent(); // Save changes after removing
            }
        }
    </script>
    <!-- alert to upgrade plan -->
    <script>
        function showUpgradeAlert() {
            // Check if an alert already exists to avoid duplicates
            let existingAlert = document.getElementById('upgrade-alert');
            if (existingAlert) return;

            // Create the alert container
            const alertContainer = document.createElement('div');
            alertContainer.id = 'upgrade-alert';
            alertContainer.style.cssText = `
                background-color: #ffe5e5;
                border: 1px solid #f5c2c2;
                color: #a94442;
                padding: 15px;
                margin: 20px auto;
                border-radius: 5px;
                text-align: center;
                width: 80%;
                max-width: 500px;
                position: relative;
            `;

            // Add alert message
            const message = document.createElement('p');
            message.textContent = 'No prompts remaining. Please upgrade your plan to continue.';
            alertContainer.appendChild(message);

            // Add "Upgrade Now" button
            const upgradeButton = document.createElement('button');
            upgradeButton.textContent = 'Upgrade Now';
            upgradeButton.style.cssText = `
                background-color: #007bff;
                color: #fff;
                padding: 10px 20px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                margin-top: 10px;
            `;
            upgradeButton.onclick = function () {
                window.location.href = '/'; // Redirect to the upgrade page
            };
            alertContainer.appendChild(upgradeButton);

            // Add a close button
            const closeButton = document.createElement('span');
            closeButton.textContent = '×';
            closeButton.style.cssText = `
                position: absolute;
                top: 10px;
                right: 15px;
                cursor: pointer;
                font-size: 20px;
            `;
            closeButton.onclick = function () {
                alertContainer.remove(); // Remove the alert when close button is clicked
            };
            alertContainer.appendChild(closeButton);

            // Append the alert container to the body or a specific container
            const mainContainer = document.getElementById('main-container') || document.body;
            mainContainer.prepend(alertContainer);
        }

    </script>
    <script>
        function adjustPageHeight() {
            const pages = document.querySelectorAll('.page');
            const defaultHeight = 297 * 3.78; // A4 height in pixels at 96 DPI

            pages.forEach((page) => {
                const contentHeight = page.scrollHeight;

                // Check if content exceeds default height
                if (contentHeight > defaultHeight) {
                    const newHeight = Math.ceil(contentHeight); // Add 10mm padding
                    page.style.height = `${newHeight}px`; // Set new height dynamically
                    console.log(`Page extended to ${newHeight}px`);

                    // Add dotted line at the default height to indicate A4 boundary
                    const dottedLine = page.querySelector('.dotted-line') || document.createElement('div');
                    dottedLine.className = 'dotted-line';
                    dottedLine.style.position = 'absolute';
                    dottedLine.style.top = `${defaultHeight}px`;
                    dottedLine.style.left = '0';
                    dottedLine.style.width = '100%';
                    dottedLine.style.borderTop = '1px dashed black';
                    page.appendChild(dottedLine);
                }
            });
        }

        // Call this function after any content is added or modified
        document.addEventListener('DOMContentLoaded', () => {
            adjustPageHeight();
        });
    </script>
</body>
</html>
